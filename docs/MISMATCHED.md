
# Entry Point Analysis - Mismatches & Clarifications

**Date:** 2025-01-XX  
**Status:** Analysis Complete

---

## Overview

This document analyzes the entry points in the Vecto Pilot codebase, clarifying which files are true server entry points versus module exports and build artifacts.

---

## Entry Point Categories

### 1. Primary Server Entry Points ✅

These are executable Node.js servers that bind to ports and handle requests:

#### **`gateway-server.js`** (Port 5000)
- **Status:** Active - Main Application Entry Point
- **Purpose:** Primary HTTP server, SPA serving, API routing
- **Configuration:** 
  - Defined in `.replit` as `entrypoint`
  - Started via `scripts/start-replit.js`
  - Runs in MONO or SPLIT mode
- **Dependencies:** Spawns SDK and Agent servers as child processes in SPLIT mode

#### **`index.js`** (SDK Server)
- **Status:** Active - Eidolon SDK Server
- **Purpose:** Enhanced AI assistant capabilities
- **Port Configuration:** `EIDOLON_PORT` or `PORT` env vars
- **Modes:**
  - Standalone (legacy/direct mode)
  - Child process (spawned by gateway in SPLIT mode)
  - Embedded (imported by gateway in MONO mode)

#### **`agent-server.js`** (Port 43717)
- **Status:** Active - Agent Workspace Intelligence
- **Purpose:** File system operations, shell commands, database access
- **Port Configuration:** `AGENT_PORT` (default: 43717)
- **Security:** Token auth and rate limiting
- **Modes:**
  - Standalone process
  - Child process (spawned by gateway)
  - Embedded (imported by gateway in MONO mode)

---

### 2. Module Exports (NOT Server Entry Points) ⚠️

These are library modules that export functions/objects for other code to import:

#### **`server/lib/adapters/index.js`**
- **Type:** Integration Point (not entry point)
- **Exports:** `callModel()` function
- **Purpose:** Role-based LLM routing dispatcher
- **Routes to:** OpenAI, Anthropic, Gemini adapters
- **Usage:** Imported by other server modules

#### **`server/lib/strategies/index.js`**
- **Type:** Registry Module (not entry point)
- **Exports:** 
  - `providers` map (strategy generators)
  - `assertStrategies()` validation function
- **Purpose:** Strategy provider registry and validation
- **Usage:** Called during gateway server boot

---

### 3. Build Artifacts (NOT Runtime Entry Points) ⚠️

These are generated files from compilation/build processes:

#### **`dist/index.js`**
- **Type:** Build Output
- **Source:** Compiled from `src/index.ts` (TypeScript agent source)
- **Status:** Not directly executed in current setup
- **Related To:** GPT-5 agent package
- **Note:** Part of the `gpt5-agent-package` build process

#### **UI Build Artifacts**
- **Files:** 
  - `client/dist/index-BzKHz2OF.js`
  - `client/dist/index.html`
- **Type:** Client-side build artifacts
- **Generated By:** Vite build process
- **Purpose:** Frontend application bundle
- **Served By:** Gateway server (static file serving)

---

## Current Startup Sequence

```
1. .replit run command → loads mono-mode.env
2. Executes: npm run start:replit
3. Runs: scripts/start-replit.js
4. Starts: gateway-server.js on port 5000
5. Gateway Mode:
   - MONO: Embeds SDK and Agent directly
   - SPLIT: Spawns SDK (port 3101) and Agent (port 43717) as child processes
```

---

## Mismatched Assumptions

### ❌ **Incorrect:** `dist/index.js` is an active entry point
- **Reality:** This is a build artifact from TypeScript compilation
- **Not executed:** In the current runtime architecture
- **Purpose:** Part of agent package, not the main server flow

### ❌ **Incorrect:** UI references are server entry points
- **Files Listed:** `index-BzKHz2OF.js`, `index.html`
- **Reality:** These are client-side build artifacts in `client/dist/`
- **Purpose:** Frontend bundle served as static files
- **Not server entry points:** They run in the browser, not Node.js

### ❌ **Incorrect:** Module exports are entry points
- **Files:** `server/lib/adapters/index.js`, `server/lib/strategies/index.js`
- **Reality:** These are library modules imported by other code
- **Purpose:** Provide functions and configuration, not start servers
- **No port binding:** They don't listen on any ports

---

## Correct Entry Point Summary

| File | Type | Port | Active | Purpose |
|------|------|------|--------|---------|
| `gateway-server.js` | Server Entry Point | 5000 | ✅ Yes | Main HTTP server & router |
| `index.js` | Server Entry Point | 3101* | ✅ Yes | Eidolon SDK server |
| `agent-server.js` | Server Entry Point | 43717 | ✅ Yes | Agent workspace server |
| `server/lib/adapters/index.js` | Module Export | N/A | N/A | LLM adapter dispatcher |
| `server/lib/strategies/index.js` | Module Export | N/A | N/A | Strategy registry |
| `dist/index.js` | Build Artifact | N/A | ❌ No | Agent TypeScript build |
| `client/dist/index-*.js` | Build Artifact | N/A | ❌ No | Frontend bundle |

*Port depends on mode and configuration

---

## Environment Configuration

### MONO Mode (Current Default)
```bash
APP_MODE=mono
PORT=5000
```
- Gateway embeds SDK and Agent directly
- Single process
- All services on port 5000

### SPLIT Mode
```bash
APP_MODE=split
PORT=5000              # Gateway
SDK_PORT=3101          # Eidolon SDK
AGENT_PORT=43717       # Agent
```
- Gateway spawns child processes
- Multiple processes
- Each service on separate port

---

## Health Endpoints

All three server entry points provide health endpoints:

### Gateway (`gateway-server.js`)
- `/api/health` → `{ok: true, port: 5000, mode: "mono"}`
- `/health` → `OK`
- `/healthz` → `OK`
- `/ready` → `OK`

### SDK (`index.js`)
- `/health` → Health status
- `/diagnostics/memory` → Memory usage
- `/diagnostics/preferences` → User preferences
- `/diagnostics/session` → Session info

### Agent (`agent-server.js`)
- `/healthz` → `{ok: true, agent: true, t: <timestamp>}`

---

## Verification Commands

### Check Running Processes
```bash
ps aux | grep node
```

### Check Port Bindings
```bash
lsof -i :5000    # Gateway
lsof -i :3101    # SDK (SPLIT mode)
lsof -i :43717   # Agent (SPLIT mode)
```

### Test Health Endpoints
```bash
curl http://localhost:5000/api/health
curl http://localhost:5000/health
```

---

## Conclusion

The Vecto Pilot codebase has **three true server entry points**:
1. `gateway-server.js` - Main application server
2. `index.js` - Eidolon SDK server
3. `agent-server.js` - Agent workspace server

All other files mentioned are either:
- Module exports (library code)
- Build artifacts (generated files)
- Client-side bundles (browser code)

Understanding this distinction is critical for:
- Debugging startup issues
- Understanding the architecture
- Configuring deployment
- Troubleshooting port conflicts
