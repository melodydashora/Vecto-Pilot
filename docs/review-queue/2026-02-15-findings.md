# Session Findings — February 15, 2026

**Analyzed By:** Claude Opus 4.6
**Date:** 2026-02-15
**Purpose:** Low-priority observations and suggestions for Melody to review

---

## Summary

Full codebase audit covering 245 server files and 161 client files. The codebase is in excellent health — no critical issues found. The items below are refinement opportunities, not blockers.

---

## Findings

### F-001: models-dictionary.js Is Orphaned Dead Code

**Location:** `server/lib/ai/models-dictionary.js`
**Priority:** Low
**Issue:** This file contains old role names (`strategist`, `briefer`, `consolidator`) and references deprecated models (Gemini 2.5 Pro, Claude 3.5 Sonnet). The `model-registry.js` is now the sole source of truth and has `LEGACY_ROLE_MAP` for backward compatibility.
**Impact:** Confusion for future contributors or AI agents reading both files.
**Recommendation:** Either delete or add a prominent `@deprecated` header pointing to `model-registry.js`.

---

### F-002: ~~Gemini thinkingLevel Not Validated at Adapter Level~~ ✅ FIXED

**Location:** `server/lib/ai/adapters/gemini-adapter.js`
**Priority:** Low-Medium
**Status:** **FIXED** (2026-02-15)
**Fix:** Added `validateThinkingLevel()` function in `gemini-adapter.js` that validates thinkingLevel against model type. Pro models (gemini-3-pro) auto-correct MEDIUM → HIGH with a warning log. Flash models accept LOW/MEDIUM/HIGH. Enforced in both `callGemini()` and `callGeminiStream()`. Also added Pro/Flash-specific quirk entries in `model-registry.js` MODEL_QUIRKS.

---

### F-003: District Field Has Two Sources of Truth

**Location:** `ranking_candidates.district` vs `venue_catalog.district`
**Priority:** Low
**Issue:** The tactical planner (GPT-5.2) generates a district name for each venue. The venue enrichment also resolves a district from Google Places. It's unclear which takes precedence.
**Impact:** Could cause minor inconsistencies in UI display.
**Recommendation:** Document the precedence rule (e.g., "catalog district is authoritative; planner district is contextual").

---

### F-004: Deprecated Hook Still Exists

**Location:** `client/src/hooks/useStrategyPolling.ts`
**Priority:** Low
**Issue:** Marked as DEPRECATED since 2026-01-15. `useCoPilot()` replaced it via SSE subscriptions.
**Impact:** File bloat — no runtime impact since nothing imports it.
**Recommendation:** Delete after verifying no references.

---

### F-005: Error Response Shape Inconsistency in Adapters

**Location:** `server/lib/ai/adapters/` (all 3 adapters)
**Priority:** Low
**Issue:** Some error paths return `{ ok: false, error: 'message' }`, others return `{ ok: false, output: '' }`. Callers handle both patterns, but it's not standardized.
**Impact:** Minor — all callers are tolerant.
**Recommendation:** Standardize on `{ ok: false, error: string, output: '' }`.

---

### F-006: WORKFLOW_FILE_LISTING.md References .cache/ Internal Files

**Location:** `WORKFLOW_FILE_LISTING.md:13-14`
**Priority:** Low
**Issue:** Generated listing includes `.cache/uv/` pyright stubs as "UI" links, which are Replit internal cache artifacts.
**Impact:** Confusing for documentation readers.
**Recommendation:** Filter `.cache/` paths from the generator.

---

### F-007: GEMINIANALYSIS.md Uses Wrong Model Names

**Location:** `GEMINIANALYSIS.md:12-14`
**Priority:** Low
**Issue:** References "Claude Sonnet 4.5" as the Strategist model but `model-registry.js` shows it's `claude-opus-4-6`. Also says "Gemini 2.5 Pro" for validation, which is now `gemini-3-pro-preview`.
**Impact:** Documentation-only — code is correct.
**Recommendation:** Update file or add deprecation header.

---

### F-008: Console Logs in Production Client Code

**Location:** Multiple client files (LocationContext, CoPilotContext, GlobalHeader)
**Priority:** Low
**Issue:** `console.log()` statements exist throughout for debugging. Not gated by environment.
**Impact:** Performance and privacy — logs GPS coords and strategy data to browser console.
**Recommendation:** Add `if (import.meta.env.DEV)` guard around debug logs.

---

### F-009: CamelCase/Snake_Case Tolerance in co-pilot-context.tsx

**Location:** `client/src/contexts/co-pilot-context.tsx:685-687`
**Priority:** Low
**Issue:** Code accepts BOTH `schoolClosures` and `school_closures` from server responses:
```typescript
schoolClosures: data?.schoolClosures ?? data?.school_closures ?? [],
```
**Impact:** Masks potential server inconsistency.
**Recommendation:** Verify server response format is standardized to camelCase, then remove snake_case fallback.

---

### F-010: pending.md Is 257KB and Growing

**Location:** `docs/review-queue/pending.md`
**Priority:** Medium
**Issue:** The change analyzer appends to this file on every server start without truncation. At 257KB it's too large to read in a single pass.
**Impact:** Slows down session-start reviews and can't be fully loaded by AI tools.
**Recommendation:** Archive entries older than 2 weeks into `docs/reviewed-queue/` and truncate pending.md.

---

### F-011: Gemini Document Orchestrator — Fixed

**Location:** `server/lib/docs-agent/orchestrator.js`
**Priority:** Was Critical — Now Fixed
**Issue:** The orchestrator had 4 bugs preventing it from working:
1. `mapFileToDoc()` only had 4 hardcoded entries (auth, schema, adapters, strategy)
2. `config/docs-policy.json` was loaded but never used
3. File paths were relative but `fs.readFile` needs absolute paths
4. No deduplication — same doc could be processed multiple times
**Fix Applied:** Rewrote orchestrator to use `findAffectedDocs()` from the change-analyzer's comprehensive mapping (30+ entries), load `config/docs-policy.json`, resolve absolute paths, and deduplicate targets.

---

### F-012: SAVE-IMPORTANT.md / generic-honking-cocke.md Purpose Unclear

**Location:** Root level
**Priority:** Low
**Issue:** These files exist at root with unclear purpose. `generic-honking-cocke.md` appears to be a Replit-generated file.
**Recommendation:** Review contents — archive if not needed, delete if garbage.

---

## Statistics

| Category | Count |
|----------|-------|
| Server JS/TS Files | ~245 |
| Client TSX/TS Files | ~161 |
| Model Registry Roles | 31 |
| README Files | 95+ |
| Root MD Files | 21 |
| Registered API Routes | 30+ |
| Shadcn/UI Components | 48 |
| Custom Hooks | 16 |
| DOC_DISCREPANCIES Fixed | 32/32 (all resolved) |
| Pending Review Items | 7 high, 6 medium, 28 low priority |

---

**Next Steps:** Melody to review these findings and decide which to action.
