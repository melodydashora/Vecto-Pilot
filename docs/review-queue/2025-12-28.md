# Change Analysis - 2025-12-28

## Session Summary

**Branch:** main
**Last Commit:** `4a857af` fix: Add smart retry logic for briefing data placeholders

### Key Changes This Session

#### Map Features (Implemented & Documented)
- [x] Bar markers on map (green=open, red=closing soon)
- [x] Multi-day event support (date range filtering)
- [x] SmartBlocks two-pass filtering (Grade A/B, spacing preferred)
- [x] Package lockfile regenerated

#### Briefing Fixes
- [x] GlobalHeader shows "Resolving location..." instead of raw coords
- [x] Briefing queries run as soon as snapshotId exists (removed pipeline phase gate)
- [x] Smart retry for placeholder data (traffic, news, airport poll every 5s until real data)

#### Documentation Updated
- [x] `docs/memory/sessions/2025-12-28-map-features.md` - Full session notes
- [x] `client/src/components/README.md` - MapTab bar markers

### Pending Database Fix

User action required before deploy:
```sql
-- Run in Supabase SQL Editor (Dev database)
DROP INDEX IF EXISTS idx_events_dedupe;
CREATE UNIQUE INDEX idx_events_dedupe ON events_facts USING btree (
  COALESCE(venue_place_id, ''::text),
  lower(event_title),
  start_time,
  end_time
);
```

### Documentation Review Needed

#### High Priority
- [ ] `docs/architecture/database-schema.md` - Database schema changes (shared/schema.js)
- [ ] `docs/preflight/database.md` - Database schema changes (shared/schema.js)

#### Medium Priority
- [ ] `docs/architecture/client-structure.md` - Router refactor, page structure changes

#### Low Priority (Deferred)
- [ ] MCP server docs - not critical for Beta

### Status: REVIEWED

---

## Previous Router Refactor (2025-12-27)

The co-pilot page was split into separate route-based pages:

| Route | Page Component |
|-------|----------------|
| `/co-pilot/strategy` | StrategyPage.tsx |
| `/co-pilot/bars` | BarsPage.tsx |
| `/co-pilot/briefing` | BriefingPage.tsx |
| `/co-pilot/map` | MapPage.tsx |
| `/co-pilot/intel` | IntelPage.tsx |
| `/co-pilot/about` | AboutPage.tsx |

Shared state moved to `co-pilot-context.tsx`, layout to `CoPilotLayout.tsx`.

### Status: REVIEWED
## 2025-12-28 Analysis

**Generated:** 2025-12-28T03:14:09.544Z
**Branch:** main
**Last Commit:** fb3683f fix: Add retry count limit to prevent infinite polling

### Uncommitted Changes (2)
| File | Status |
|------|--------|
| `ocs/review-queue/2025-12-28.md` | Modified |
| `docs/review-queue/pending.md` | Modified |

### Recent Commit Changes (2)
| File | Status |
|------|--------|
| `client/src/components/GlobalHeader.tsx` | Modified |
| `client/src/hooks/useBriefingQueries.ts` | Modified |

### Documentation Review Needed

#### Medium Priority
- [ ] `docs/architecture/client-structure.md` - Component changes (client/src/components/GlobalHeader.tsx)

### Status: PENDING

---

## 2025-12-28 Analysis

**Generated:** 2025-12-28T15:09:24.318Z
**Branch:** main
**Last Commit:** 5c2f35a Assistant checkpoint

### Uncommitted Changes (4)
| File | Status |
|------|--------|
| `lient/src/components/README.md` | Modified |
| `client/src/contexts/README.md` | Modified |
| `client/src/hooks/README.md` | Modified |
| `client/src/pages/co-pilot/README.md` | Untracked |

### Recent Commit Changes (24)
| File | Status |
|------|--------|
| `.claude/settings.local.json` | Modified |
| `CLAUDE.md` | Modified |
| `LESSONS_LEARNED.md` | Modified |
| `MODEL.md` | Modified |
| `PRODISSUES.md` | Added |
| `docs/ai-tools/README.md` | Modified |
| `docs/ai-tools/mcp.md` | Deleted |
| `docs/preflight/ai-models.md` | Modified |
| `server/api/README.md` | Modified |
| `server/api/mcp/README.md` | Deleted |
| `server/api/mcp/mcp.js` | Deleted |
| `server/bootstrap/middleware.js` | Modified |
| `server/bootstrap/routes.js` | Modified |
| `server/eidolon/README.md` | Modified |
| `server/eidolon/config.ts` | Modified |
| `server/eidolon/index.ts` | Modified |
| `server/eidolon/tools/README.md` | Modified |
| `server/eidolon/tools/mcp-diagnostics.js` | Deleted |
| `server/lib/README.md` | Modified |
| `server/lib/ai/README.md` | Modified |
| ... and 4 more | |

### Documentation Review Needed

#### High Priority
- [ ] `docs/architecture/client-structure.md` - Context provider changes (client/src/contexts/README.md)
- [ ] `docs/architecture/api-reference.md` - API endpoint changes (server/api/README.md)
- [ ] `docs/preflight/ai-models.md` - AI model/adapter changes (server/lib/ai/README.md)
- [ ] `docs/architecture/ai-pipeline.md` - AI model/adapter changes (server/lib/ai/README.md)
- [ ] `server/lib/ai/README.md` - Model adapter changes (server/lib/ai/adapters/gemini-adapter.js)

#### Medium Priority
- [ ] `docs/ai-tools/eidolon.md` - Eidolon SDK changes (server/eidolon/README.md)
- [ ] `server/eidolon/README.md` - Eidolon SDK changes (server/eidolon/README.md)

### Status: PENDING

---

## 2025-12-28 Analysis

**Generated:** 2025-12-28T15:15:00.970Z
**Branch:** main
**Last Commit:** b9fc00f Assistant checkpoint

### Recent Commit Changes (8)
| File | Status |
|------|--------|
| `PRODISSUES.md` | Added |
| `client/src/components/README.md` | Modified |
| `client/src/contexts/README.md` | Modified |
| `client/src/hooks/README.md` | Modified |
| `client/src/pages/co-pilot/README.md` | Added |
| `docs/architecture/README.md` | Modified |
| `docs/review-queue/2025-12-28.md` | Modified |
| `docs/review-queue/pending.md` | Modified |

### Documentation Review Needed

#### Medium Priority
- [ ] `docs/architecture/client-structure.md` - Component changes (client/src/components/README.md)

### Status: PENDING

---

## 2025-12-28 Analysis

**Generated:** 2025-12-28T15:44:47.630Z
**Branch:** main
**Last Commit:** b9fc00f Assistant checkpoint

### Uncommitted Changes (7)
| File | Status |
|------|--------|
| `ocs/review-queue/2025-12-28.md` | Modified |
| `docs/review-queue/pending.md` | Modified |
| `server/api/location/location.js` | Modified |
| `server/api/location/snapshot.js` | Modified |
| `server/lib/location/get-snapshot-context.js` | Modified |
| `shared/schema.js` | Modified |
| `migrations/20251228_drop_snapshot_user_device.sql` | Untracked |

### Recent Commit Changes (8)
| File | Status |
|------|--------|
| `PRODISSUES.md` | Added |
| `client/src/components/README.md` | Modified |
| `client/src/contexts/README.md` | Modified |
| `client/src/hooks/README.md` | Modified |
| `client/src/pages/co-pilot/README.md` | Added |
| `docs/architecture/README.md` | Modified |
| `docs/review-queue/2025-12-28.md` | Modified |
| `docs/review-queue/pending.md` | Modified |

### Documentation Review Needed

#### High Priority
- [ ] `docs/architecture/api-reference.md` - API endpoint changes (server/api/location/location.js)
- [ ] `docs/preflight/location.md` - Location/GPS changes (server/lib/location/get-snapshot-context.js)
- [ ] `docs/architecture/constraints.md` - Location/GPS changes (server/lib/location/get-snapshot-context.js)
- [ ] `docs/architecture/database-schema.md` - Database schema changes (shared/schema.js)
- [ ] `docs/preflight/database.md` - Database schema changes (shared/schema.js)

#### Medium Priority
- [ ] `docs/architecture/client-structure.md` - Component changes (client/src/components/README.md)

### Status: PENDING

---

## 2025-12-28 Analysis

**Generated:** 2025-12-28T17:52:53.523Z
**Branch:** main
**Last Commit:** b9fc00f Assistant checkpoint

### Uncommitted Changes (22)
| File | Status |
|------|--------|
| `claude/settings.local.json` | Modified |
| `client/src/App.tsx` | Modified |
| `client/src/routes.tsx` | Modified |
| `docs/review-queue/2025-12-28.md` | Modified |
| `docs/review-queue/pending.md` | Modified |
| `package-lock.json` | Modified |
| `package.json` | Modified |
| `server/api/auth/auth.js` | Modified |
| `server/api/location/location.js` | Modified |
| `server/api/location/snapshot.js` | Modified |
| `server/api/platform/index.js` | Modified |
| `server/bootstrap/routes.js` | Modified |
| `server/lib/location/get-snapshot-context.js` | Modified |
| `shared/schema.js` | Modified |
| `client/src/components/auth/` | Untracked |
| `client/src/contexts/auth-context.tsx` | Untracked |
| `client/src/pages/auth/` | Untracked |
| `client/src/types/auth.ts` | Untracked |
| `migrations/20251228_auth_system_tables.sql` | Untracked |
| `migrations/20251228_drop_snapshot_user_device.sql` | Untracked |
| ... and 2 more | |

### Recent Commit Changes (8)
| File | Status |
|------|--------|
| `PRODISSUES.md` | Added |
| `client/src/components/README.md` | Modified |
| `client/src/contexts/README.md` | Modified |
| `client/src/hooks/README.md` | Modified |
| `client/src/pages/co-pilot/README.md` | Added |
| `docs/architecture/README.md` | Modified |
| `docs/review-queue/2025-12-28.md` | Modified |
| `docs/review-queue/pending.md` | Modified |

### Documentation Review Needed

#### High Priority
- [ ] `docs/architecture/auth-system.md` - Authentication changes (server/api/auth/auth.js)
- [ ] `docs/architecture/api-reference.md` - Authentication changes (server/api/auth/auth.js)
- [ ] `docs/preflight/location.md` - Location/GPS changes (server/lib/location/get-snapshot-context.js)
- [ ] `docs/architecture/constraints.md` - Location/GPS changes (server/lib/location/get-snapshot-context.js)
- [ ] `docs/architecture/database-schema.md` - Database schema changes (shared/schema.js)
- [ ] `docs/preflight/database.md` - Database schema changes (shared/schema.js)

#### Medium Priority
- [ ] `docs/architecture/client-structure.md` - Component changes (client/src/components/auth/)

### Status: PENDING

---

## 2025-12-28 Analysis

**Generated:** 2025-12-28T18:48:27.159Z
**Branch:** main
**Last Commit:** b9fc00f Assistant checkpoint

### Uncommitted Changes (24)
| File | Status |
|------|--------|
| `claude/settings.local.json` | Modified |
| `client/src/App.tsx` | Modified |
| `client/src/routes.tsx` | Modified |
| `docs/review-queue/2025-12-28.md` | Modified |
| `docs/review-queue/pending.md` | Modified |
| `package-lock.json` | Modified |
| `package.json` | Modified |
| `server/api/auth/auth.js` | Modified |
| `server/api/location/location.js` | Modified |
| `server/api/location/snapshot.js` | Modified |
| `server/api/platform/index.js` | Modified |
| `server/bootstrap/routes.js` | Modified |
| `server/lib/location/get-snapshot-context.js` | Modified |
| `shared/schema.js` | Modified |
| `client/src/components/auth/` | Untracked |
| `client/src/contexts/auth-context.tsx` | Untracked |
| `client/src/pages/auth/` | Untracked |
| `client/src/types/auth.ts` | Untracked |
| `docs/architecture/authentication.md` | Untracked |
| `migrations/20251228_auth_system_tables.sql` | Untracked |
| ... and 4 more | |

### Recent Commit Changes (8)
| File | Status |
|------|--------|
| `PRODISSUES.md` | Added |
| `client/src/components/README.md` | Modified |
| `client/src/contexts/README.md` | Modified |
| `client/src/hooks/README.md` | Modified |
| `client/src/pages/co-pilot/README.md` | Added |
| `docs/architecture/README.md` | Modified |
| `docs/review-queue/2025-12-28.md` | Modified |
| `docs/review-queue/pending.md` | Modified |

### Documentation Review Needed

#### High Priority
- [ ] `docs/architecture/auth-system.md` - Authentication changes (server/api/auth/auth.js)
- [ ] `docs/architecture/api-reference.md` - Authentication changes (server/api/auth/auth.js)
- [ ] `docs/preflight/location.md` - Location/GPS changes (server/lib/location/get-snapshot-context.js)
- [ ] `docs/architecture/constraints.md` - Location/GPS changes (server/lib/location/get-snapshot-context.js)
- [ ] `docs/architecture/database-schema.md` - Database schema changes (shared/schema.js)
- [ ] `docs/preflight/database.md` - Database schema changes (shared/schema.js)

#### Medium Priority
- [ ] `docs/architecture/client-structure.md` - Component changes (client/src/components/auth/)

### Status: PENDING

---

## 2025-12-28 Analysis

**Generated:** 2025-12-28T22:00:18.457Z
**Branch:** main
**Last Commit:** b9fc00f Assistant checkpoint

### Uncommitted Changes (24)
| File | Status |
|------|--------|
| `claude/settings.local.json` | Modified |
| `client/src/App.tsx` | Modified |
| `client/src/routes.tsx` | Modified |
| `docs/review-queue/2025-12-28.md` | Modified |
| `docs/review-queue/pending.md` | Modified |
| `package-lock.json` | Modified |
| `package.json` | Modified |
| `server/api/auth/auth.js` | Modified |
| `server/api/location/location.js` | Modified |
| `server/api/location/snapshot.js` | Modified |
| `server/api/platform/index.js` | Modified |
| `server/bootstrap/routes.js` | Modified |
| `server/lib/location/get-snapshot-context.js` | Modified |
| `shared/schema.js` | Modified |
| `client/src/components/auth/` | Untracked |
| `client/src/contexts/auth-context.tsx` | Untracked |
| `client/src/pages/auth/` | Untracked |
| `client/src/types/auth.ts` | Untracked |
| `docs/architecture/authentication.md` | Untracked |
| `migrations/20251228_auth_system_tables.sql` | Untracked |
| ... and 4 more | |

### Recent Commit Changes (8)
| File | Status |
|------|--------|
| `PRODISSUES.md` | Added |
| `client/src/components/README.md` | Modified |
| `client/src/contexts/README.md` | Modified |
| `client/src/hooks/README.md` | Modified |
| `client/src/pages/co-pilot/README.md` | Added |
| `docs/architecture/README.md` | Modified |
| `docs/review-queue/2025-12-28.md` | Modified |
| `docs/review-queue/pending.md` | Modified |

### Documentation Review Needed

#### High Priority
- [ ] `docs/architecture/auth-system.md` - Authentication changes (server/api/auth/auth.js)
- [ ] `docs/architecture/api-reference.md` - Authentication changes (server/api/auth/auth.js)
- [ ] `docs/preflight/location.md` - Location/GPS changes (server/lib/location/get-snapshot-context.js)
- [ ] `docs/architecture/constraints.md` - Location/GPS changes (server/lib/location/get-snapshot-context.js)
- [ ] `docs/architecture/database-schema.md` - Database schema changes (shared/schema.js)
- [ ] `docs/preflight/database.md` - Database schema changes (shared/schema.js)

#### Medium Priority
- [ ] `docs/architecture/client-structure.md` - Component changes (client/src/components/auth/)

### Status: PENDING

---

