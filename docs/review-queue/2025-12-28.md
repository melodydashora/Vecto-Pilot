# Change Analysis - 2025-12-28

## Session Summary

**Branch:** main
**Last Commit:** `4a857af` fix: Add smart retry logic for briefing data placeholders

### Key Changes This Session

#### Map Features (Implemented & Documented)
- [x] Bar markers on map (green=open, red=closing soon)
- [x] Multi-day event support (date range filtering)
- [x] SmartBlocks two-pass filtering (Grade A/B, spacing preferred)
- [x] Package lockfile regenerated

#### Briefing Fixes
- [x] GlobalHeader shows "Resolving location..." instead of raw coords
- [x] Briefing queries run as soon as snapshotId exists (removed pipeline phase gate)
- [x] Smart retry for placeholder data (traffic, news, airport poll every 5s until real data)

#### Documentation Updated
- [x] `docs/memory/sessions/2025-12-28-map-features.md` - Full session notes
- [x] `client/src/components/README.md` - MapTab bar markers

### Pending Database Fix

User action required before deploy:
```sql
-- Run in Supabase SQL Editor (Dev database)
DROP INDEX IF EXISTS idx_events_dedupe;
CREATE UNIQUE INDEX idx_events_dedupe ON events_facts USING btree (
  COALESCE(venue_place_id, ''::text),
  lower(event_title),
  start_time,
  end_time
);
```

### Documentation Review Needed

#### High Priority
- [ ] `docs/architecture/database-schema.md` - Database schema changes (shared/schema.js)
- [ ] `docs/preflight/database.md` - Database schema changes (shared/schema.js)

#### Medium Priority
- [ ] `docs/architecture/client-structure.md` - Router refactor, page structure changes

#### Low Priority (Deferred)
- [ ] MCP server docs - not critical for Beta

### Status: REVIEWED

---

## Previous Router Refactor (2025-12-27)

The co-pilot page was split into separate route-based pages:

| Route | Page Component |
|-------|----------------|
| `/co-pilot/strategy` | StrategyPage.tsx |
| `/co-pilot/bars` | BarsPage.tsx |
| `/co-pilot/briefing` | BriefingPage.tsx |
| `/co-pilot/map` | MapPage.tsx |
| `/co-pilot/intel` | IntelPage.tsx |
| `/co-pilot/about` | AboutPage.tsx |

Shared state moved to `co-pilot-context.tsx`, layout to `CoPilotLayout.tsx`.

### Status: REVIEWED
## 2025-12-28 Analysis

**Generated:** 2025-12-28T03:14:09.544Z
**Branch:** main
**Last Commit:** fb3683f fix: Add retry count limit to prevent infinite polling

### Uncommitted Changes (2)
| File | Status |
|------|--------|
| `ocs/review-queue/2025-12-28.md` | Modified |
| `docs/review-queue/pending.md` | Modified |

### Recent Commit Changes (2)
| File | Status |
|------|--------|
| `client/src/components/GlobalHeader.tsx` | Modified |
| `client/src/hooks/useBriefingQueries.ts` | Modified |

### Documentation Review Needed

#### Medium Priority
- [ ] `docs/architecture/client-structure.md` - Component changes (client/src/components/GlobalHeader.tsx)

### Status: PENDING

---

