
# Entry Point Analysis - Mismatches & Clarifications

**Date:** 2025-01-30  
**Status:** Analysis Complete

---

## Overview

This document analyzes the entry points in the Vecto Pilot codebase, clarifying which files are true server entry points versus module exports and build artifacts.

---

## Entry Point Categories

### 1. Primary Server Entry Points ✅

These are executable Node.js servers that bind to ports and handle requests:

#### **`gateway-server.js`** (Port 5000)
- **Status:** Active - Main Application Entry Point
- **Purpose:** Primary HTTP server, SPA serving, API routing
- **Configuration:** 
  - Defined in `.replit` as `entrypoint`
  - Started via `scripts/start-replit.js`
  - Runs in MONO or SPLIT mode
- **Dependencies:** Spawns SDK and Agent servers as child processes in SPLIT mode

#### **`index.js`** (SDK Server)
- **Status:** Active - Eidolon SDK Server
- **Purpose:** Enhanced AI assistant capabilities
- **Port Configuration:** `EIDOLON_PORT` or `PORT` env vars
- **Modes:**
  - Standalone (legacy/direct mode)
  - Child process (spawned by gateway in SPLIT mode)
  - Embedded (imported by gateway in MONO mode)

#### **`agent-server.js`** (Port 43717)
- **Status:** Active - Agent Workspace Intelligence
- **Purpose:** File system operations, shell commands, database access
- **Port Configuration:** `AGENT_PORT` (default: 43717)
- **Security:** Token auth and rate limiting
- **Modes:**
  - Standalone process
  - Child process (spawned by gateway)
  - Embedded (imported by gateway in MONO mode)

---

### 2. Module Exports (NOT Server Entry Points) ⚠️

These are library modules that export functions/objects for other code to import:

#### **`server/lib/adapters/index.js`**
- **Type:** Integration Point (not entry point)
- **Exports:** `callModel()` function
- **Purpose:** Role-based LLM routing dispatcher
- **Routes to:** OpenAI, Anthropic, Gemini adapters
- **Usage:** Imported by other server modules

#### **`server/lib/strategies/index.js`**
- **Type:** Registry Module (not entry point)
- **Exports:** 
  - `providers` map (strategy generators)
  - `assertStrategies()` validation function
- **Purpose:** Strategy provider registry and validation
- **Usage:** Called during gateway server boot

---

### 3. Build Artifacts (NOT Runtime Entry Points) ⚠️

These are generated files from compilation/build processes:

#### **`dist/index.js`**
- **Type:** Build Output
- **Source:** Compiled from `src/index.ts` (TypeScript agent source)
- **Status:** Not directly executed in current setup
- **Related To:** GPT-5 agent package
- **Note:** Part of the `gpt5-agent-package` build process

#### **UI Build Artifacts**
- **Files:** 
  - `client/dist/index-BzKHz2OF.js`
  - `client/dist/index.html`
- **Type:** Client-side build artifacts
- **Generated By:** Vite build process
- **Purpose:** Frontend application bundle
- **Served By:** Gateway server (static file serving)

---

## Current Startup Sequence

```
1. .replit run command → loads mono-mode.env
2. Executes: npm run start:replit
3. Runs: scripts/start-replit.js
4. Starts: gateway-server.js on port 5000
5. Gateway Mode:
   - MONO: Embeds SDK and Agent directly
   - SPLIT: Spawns SDK (port 3101) and Agent (port 43717) as child processes
```

---

## Mismatched Assumptions

### ❌ **Incorrect:** `dist/index.js` is an active entry point
- **Reality:** This is a build artifact from TypeScript compilation
- **Not executed:** In the current runtime architecture
- **Purpose:** Part of agent package, not the main server flow

### ❌ **Incorrect:** UI references are server entry points
- **Files Listed:** `index-BzKHz2OF.js`, `index.html`
- **Reality:** These are client-side build artifacts in `client/dist/`
- **Purpose:** Frontend bundle served as static files
- **Not server entry points:** They run in the browser, not Node.js

### ❌ **Incorrect:** Module exports are entry points
- **Files:** `server/lib/adapters/index.js`, `server/lib/strategies/index.js`
- **Reality:** These are library modules imported by other code
- **Purpose:** Provide functions and configuration, not start servers
- **No port binding:** They don't listen on any ports

---

## Correct Entry Point Summary

| File | Type | Port | Active | Purpose |
|------|------|------|--------|---------|
| `gateway-server.js` | Server Entry Point | 5000 | ✅ Yes | Main HTTP server & router |
| `index.js` | Server Entry Point | 3101* | ✅ Yes | Eidolon SDK server |
| `agent-server.js` | Server Entry Point | 43717 | ✅ Yes | Agent workspace server |
| `server/lib/adapters/index.js` | Module Export | N/A | N/A | LLM adapter dispatcher |
| `server/lib/strategies/index.js` | Module Export | N/A | N/A | Strategy registry |
| `dist/index.js` | Build Artifact | N/A | ❌ No | Agent TypeScript build |
| `client/dist/index-*.js` | Build Artifact | N/A | ❌ No | Frontend bundle |

*Port depends on mode and configuration

---

## Environment Configuration

### MONO Mode (Current Default)
```bash
APP_MODE=mono
PORT=5000
```
- Gateway embeds SDK and Agent directly
- Single process
- All services on port 5000

### SPLIT Mode
```bash
APP_MODE=split
PORT=5000              # Gateway
SDK_PORT=3101          # Eidolon SDK
AGENT_PORT=43717       # Agent
```
- Gateway spawns child processes
- Multiple processes
- Each service on separate port

---

## Health Endpoints

All three server entry points provide health endpoints:

### Gateway (`gateway-server.js`)
- `/api/health` → `{ok: true, port: 5000, mode: "mono"}`
- `/health` → `OK`
- `/healthz` → `OK`
- `/ready` → `OK`

### SDK (`index.js`)
- `/health` → Health status
- `/diagnostics/memory` → Memory usage
- `/diagnostics/preferences` → User preferences
- `/diagnostics/session` → Session info

### Agent (`agent-server.js`)
- `/healthz` → `{ok: true, agent: true, t: <timestamp>}`

---

## Verification Commands

### Check Running Processes
```bash
ps aux | grep node
```

### Check Port Bindings
```bash
lsof -i :5000    # Gateway
lsof -i :3101    # SDK (SPLIT mode)
lsof -i :43717   # Agent (SPLIT mode)
```

### Test Health Endpoints
```bash
curl http://localhost:5000/api/health
curl http://localhost:5000/health
```

---

## Conclusion

The Vecto Pilot codebase has **three true server entry points**:
1. `gateway-server.js` - Main application server
2. `index.js` - Eidolon SDK server
3. `agent-server.js` - Agent workspace server

All other files mentioned are either:
- Module exports (library code)
- Build artifacts (generated files)
- Client-side bundles (browser code)

Understanding this distinction is critical for:
- Debugging startup issues
- Understanding the architecture
- Configuring deployment
- Troubleshooting port conflicts

---

# Complete Database Schema

**Generated:** 2025-01-30  
**Database:** PostgreSQL 16.9 (Neon)  
**ORM:** Drizzle ORM  
**Schema Source:** `shared/schema.js`

---

## Table of Contents

1. [Core Tables](#core-tables)
2. [ML Pipeline Tables](#ml-pipeline-tables)
3. [Feedback Tables](#feedback-tables)
4. [Memory Tables](#memory-tables)
5. [Utility Tables](#utility-tables)
6. [Relationships Diagram](#relationships-diagram)
7. [Indexes](#indexes)

---

## Core Tables

### 1. `snapshots` - Context Snapshots

| Column | Type | Nullable | Description |
|--------|------|----------|-------------|
| `snapshot_id` | UUID | ❌ | Primary key |
| `created_at` | TIMESTAMPTZ | ❌ | Snapshot creation time |
| `user_id` | UUID | ✅ | User identifier |
| `device_id` | UUID | ❌ | Device identifier |
| `session_id` | UUID | ❌ | Session identifier |
| `lat` | DOUBLE PRECISION | ❌ | Latitude |
| `lng` | DOUBLE PRECISION | ❌ | Longitude |
| `accuracy_m` | DOUBLE PRECISION | ✅ | GPS accuracy in meters |
| `coord_source` | TEXT | ❌ | GPS source (browser/google) |
| `city` | TEXT | ✅ | Geocoded city name |
| `state` | TEXT | ✅ | Geocoded state |
| `country` | TEXT | ✅ | Geocoded country |
| `formatted_address` | TEXT | ✅ | Full address string |
| `timezone` | TEXT | ✅ | IANA timezone |
| `local_iso` | TIMESTAMP | ✅ | Local time without timezone |
| `dow` | INTEGER | ✅ | Day of week (0=Sunday) |
| `hour` | INTEGER | ✅ | Hour of day (0-23) |
| `day_part_key` | TEXT | ✅ | Time period (morning/afternoon/evening/night) |
| `h3_r8` | TEXT | ✅ | H3 geohash resolution 8 |
| `weather` | JSONB | ✅ | Weather data from API |
| `air` | JSONB | ✅ | Air quality data |
| `airport_context` | JSONB | ✅ | Nearby airport info |
| `local_news` | JSONB | ✅ | Perplexity local news |
| `news_briefing` | JSONB | ✅ | Gemini 60-min briefing |
| `device` | JSONB | ✅ | Device metadata |
| `permissions` | JSONB | ✅ | App permissions state |
| `extras` | JSONB | ✅ | Additional context |
| `last_strategy_day_part` | TEXT | ✅ | Last strategy's day part |
| `trigger_reason` | TEXT | ✅ | Why snapshot was triggered |

---

### 2. `strategies` - AI-Generated Strategies

| Column | Type | Nullable | Description |
|--------|------|----------|-------------|
| `id` | UUID | ❌ | Primary key (auto-generated) |
| `strategy_id` | UUID | ✅ | External strategy identifier |
| `snapshot_id` | UUID | ❌ | FK to snapshots (UNIQUE, CASCADE DELETE) |
| `correlation_id` | UUID | ✅ | Request correlation ID |
| `strategy` | TEXT | ✅ | Generated strategy text |
| `status` | TEXT | ❌ | pending/ok/failed (default: pending) |
| `error_code` | INTEGER | ✅ | Error code if failed |
| `error_message` | TEXT | ✅ | Error description |
| `attempt` | INTEGER | ❌ | Retry attempt number (default: 1) |
| `latency_ms` | INTEGER | ✅ | Generation time in ms |
| `tokens` | INTEGER | ✅ | LLM tokens used |
| `next_retry_at` | TIMESTAMPTZ | ✅ | Next retry timestamp |
| `created_at` | TIMESTAMPTZ | ❌ | Creation time (default: NOW) |
| `updated_at` | TIMESTAMPTZ | ❌ | Last update time (default: NOW) |
| `model_name` | TEXT | ✅ | LLM model used |
| `model_params` | JSONB | ✅ | Model parameters |
| `prompt_version` | TEXT | ✅ | Prompt template version |
| `strategy_for_now` | TEXT | ✅ | Strategy text field |
| `lat` | DOUBLE PRECISION | ✅ | Location latitude |
| `lng` | DOUBLE PRECISION | ✅ | Location longitude |
| `city` | TEXT | ✅ | City |
| `state` | TEXT | ✅ | State |
| `user_address` | TEXT | ✅ | User address |
| `user_id` | UUID | ✅ | User identifier |
| `events` | JSONB | ✅ | Gemini events feed (default: []) |
| `news` | JSONB | ✅ | Gemini news feed (default: []) |
| `traffic` | JSONB | ✅ | Gemini traffic feed (default: []) |
| `valid_window_start` | TIMESTAMPTZ | ✅ | Strategy validity start time |
| `valid_window_end` | TIMESTAMPTZ | ✅ | Strategy validity end time |
| `valid_window_timestamp` | TIMESTAMPTZ | ✅ | Generation timestamp |
| `user_resolved_address` | TEXT | ✅ | User-resolved full address |
| `user_resolved_city` | TEXT | ✅ | User-resolved city |
| `user_resolved_state` | TEXT | ✅ | User-resolved state |
| `holiday` | TEXT | ✅ | Holiday name if applicable |
| `briefing` | JSONB | ✅ | Combined briefing data (events, holidays, traffic, news) |
| `briefing_news` | JSONB | ✅ | News from second provider (DEPRECATED) |
| `briefing_events` | JSONB | ✅ | Events from second provider (DEPRECATED) |
| `briefing_traffic` | JSONB | ✅ | Traffic from second provider (DEPRECATED) |
| `consolidated_strategy` | TEXT | ✅ | Final strategy from third provider (DEPRECATED - use strategy_for_now) |

---

### 3. `rankings` - Recommendation Sets

| Column | Type | Nullable | Description |
|--------|------|----------|-------------|
| `ranking_id` | UUID | ❌ | Primary key |
| `created_at` | TIMESTAMPTZ | ❌ | Ranking creation time |
| `snapshot_id` | UUID | ✅ | FK to snapshots |
| `correlation_id` | UUID | ✅ | Request correlation ID |
| `user_id` | UUID | ✅ | User identifier |
| `city` | TEXT | ✅ | City context |
| `ui` | JSONB | ✅ | UI metadata |
| `model_name` | TEXT | ❌ | LLM model used for ranking |
| `scoring_ms` | INTEGER | ✅ | Scoring latency |
| `planner_ms` | INTEGER | ✅ | Planner latency |
| `total_ms` | INTEGER | ✅ | Total latency |
| `timed_out` | BOOLEAN | ✅ | Did request timeout? (default: false) |
| `path_taken` | TEXT | ✅ | Which processing path (tactical/strategic) |

---

### 4. `ranking_candidates` - Individual Venue Recommendations

| Column | Type | Nullable | Description |
|--------|------|----------|-------------|
| `id` | UUID | ❌ | Primary key |
| `ranking_id` | UUID | ❌ | FK to rankings (CASCADE DELETE) |
| `block_id` | TEXT | ❌ | Unique venue block identifier |
| `name` | TEXT | ❌ | Venue name |
| `lat` | DOUBLE PRECISION | ❌ | Latitude |
| `lng` | DOUBLE PRECISION | ❌ | Longitude |
| `drive_time_min` | INTEGER | ✅ | Drive time in minutes |
| `straight_line_km` | DOUBLE PRECISION | ✅ | Straight-line distance |
| `est_earnings_per_ride` | DOUBLE PRECISION | ✅ | Estimated earnings |
| `model_score` | DOUBLE PRECISION | ✅ | ML model score |
| `rank` | INTEGER | ❌ | Display rank (1-N) |
| `exploration_policy` | TEXT | ❌ | Epsilon-greedy policy |
| `epsilon` | DOUBLE PRECISION | ✅ | Exploration rate |
| `was_forced` | BOOLEAN | ✅ | Was this a forced exploration? |
| `propensity` | DOUBLE PRECISION | ✅ | Click propensity score |
| `features` | JSONB | ✅ | ML feature vector |
| `h3_r8` | TEXT | ✅ | H3 geohash |
| `distance_miles` | DOUBLE PRECISION | ✅ | Distance in miles |
| `drive_minutes` | INTEGER | ✅ | Drive time |
| `value_per_min` | DOUBLE PRECISION | ✅ | Value per minute metric |
| `value_grade` | TEXT | ✅ | Grade (A/B/C/D/F) |
| `not_worth` | BOOLEAN | ✅ | Below value threshold? |
| `rate_per_min_used` | DOUBLE PRECISION | ✅ | Rate used in calculation |
| `trip_minutes_used` | INTEGER | ✅ | Trip duration assumption |
| `wait_minutes_used` | INTEGER | ✅ | Wait time assumption |
| `snapshot_id` | UUID | ✅ | FK to snapshots |
| `place_id` | TEXT | ✅ | Google Place ID |
| `estimated_distance_miles` | DOUBLE PRECISION | ✅ | Estimated distance |
| `drive_time_minutes` | INTEGER | ✅ | Drive time estimate |
| `distance_source` | TEXT | ✅ | Distance data source |
| `pro_tips` | TEXT[] | ✅ | Array of tactical tips |
| `closed_reasoning` | TEXT | ✅ | Why recommend if closed |
| `staging_tips` | TEXT | ✅ | Parking/staging advice |
| `staging_name` | TEXT | ✅ | Staging location name |
| `staging_lat` | DOUBLE PRECISION | ✅ | Staging latitude |
| `staging_lng` | DOUBLE PRECISION | ✅ | Staging longitude |
| `business_hours` | JSONB | ✅ | Google Places business hours |
| `venue_events` | JSONB | ✅ | Today's events at venue |

---

## ML Pipeline Tables

### 5. `actions` - User Interaction Events

| Column | Type | Nullable | Description |
|--------|------|----------|-------------|
| `action_id` | UUID | ❌ | Primary key |
| `created_at` | TIMESTAMPTZ | ❌ | Action timestamp |
| `ranking_id` | UUID | ✅ | FK to rankings (CASCADE DELETE) |
| `snapshot_id` | UUID | ❌ | FK to snapshots (CASCADE DELETE) |
| `user_id` | UUID | ✅ | User identifier |
| `action` | TEXT | ❌ | Action type (view/dwell/click/dismiss) |
| `block_id` | TEXT | ✅ | Which venue was acted upon |
| `dwell_ms` | INTEGER | ✅ | Dwell time in milliseconds |
| `from_rank` | INTEGER | ✅ | Venue's rank when clicked |
| `raw` | JSONB | ✅ | Raw event payload |

---

### 6. `venue_catalog` - Master Venue Database

| Column | Type | Nullable | Description |
|--------|------|----------|-------------|
| `venue_id` | UUID | ❌ | Primary key (auto-generated) |
| `place_id` | TEXT | ✅ | Google Place ID (UNIQUE) |
| `venue_name` | VARCHAR(500) | ❌ | Venue name (max 500 chars) |
| `address` | VARCHAR(500) | ❌ | Full address (max 500 chars) |
| `lat` | DOUBLE PRECISION | ✅ | Latitude |
| `lng` | DOUBLE PRECISION | ✅ | Longitude |
| `category` | TEXT | ❌ | Venue category |
| `dayparts` | TEXT[] | ✅ | Array of active day parts |
| `staging_notes` | JSONB | ✅ | Staging instructions |
| `city` | TEXT | ✅ | City |
| `metro` | TEXT | ✅ | Metro area |
| `ai_estimated_hours` | TEXT | ✅ | AI-estimated hours |
| `business_hours` | JSONB | ✅ | Google Places hours |
| `discovery_source` | TEXT | ❌ | How discovered (default: seed) |
| `validated_at` | TIMESTAMPTZ | ✅ | Last validation timestamp |
| `suggestion_metadata` | JSONB | ✅ | LLM suggestion details |
| `created_at` | TIMESTAMPTZ | ❌ | Creation time (default: NOW) |
| `last_known_status` | TEXT | ✅ | Business status (default: unknown) |
| `status_checked_at` | TIMESTAMPTZ | ✅ | Status check timestamp |
| `consecutive_closed_checks` | INTEGER | ✅ | Closed check counter (default: 0) |
| `auto_suppressed` | BOOLEAN | ✅ | Auto-suppressed flag (default: false) |
| `suppression_reason` | TEXT | ✅ | Why suppressed |

---

### 7. `venue_metrics` - Aggregated Venue Stats

| Column | Type | Nullable | Description |
|--------|------|----------|-------------|
| `venue_id` | UUID | ❌ | Primary key, FK to venue_catalog |
| `times_recommended` | INTEGER | ❌ | Recommendation count (default: 0) |
| `times_chosen` | INTEGER | ❌ | Click count (default: 0) |
| `positive_feedback` | INTEGER | ❌ | Thumbs up count (default: 0) |
| `negative_feedback` | INTEGER | ❌ | Thumbs down count (default: 0) |
| `reliability_score` | DOUBLE PRECISION | ❌ | Score 0-1 (default: 0.5) |
| `last_verified_by_driver` | TIMESTAMPTZ | ✅ | Last feedback timestamp |

---

## Feedback Tables

### 8. `venue_feedback` - Per-Venue Feedback

| Column | Type | Nullable | Description |
|--------|------|----------|-------------|
| `id` | UUID | ❌ | Primary key (auto-generated) |
| `user_id` | UUID | ✅ | User identifier |
| `snapshot_id` | UUID | ❌ | FK to snapshots (CASCADE DELETE) |
| `ranking_id` | UUID | ❌ | FK to rankings (CASCADE DELETE) |
| `place_id` | TEXT | ✅ | Google Place ID |
| `venue_name` | TEXT | ❌ | Venue name |
| `sentiment` | TEXT | ❌ | 'up' or 'down' |
| `comment` | TEXT | ✅ | Optional comment |
| `created_at` | TIMESTAMPTZ | ❌ | Feedback timestamp (default: NOW) |

---

### 9. `strategy_feedback` - Strategy-Level Feedback

| Column | Type | Nullable | Description |
|--------|------|----------|-------------|
| `id` | UUID | ❌ | Primary key (auto-generated) |
| `user_id` | UUID | ✅ | User identifier |
| `snapshot_id` | UUID | ❌ | FK to snapshots (CASCADE DELETE) |
| `ranking_id` | UUID | ❌ | FK to rankings (CASCADE DELETE) |
| `sentiment` | TEXT | ❌ | 'up' or 'down' |
| `comment` | TEXT | ✅ | Optional comment |
| `created_at` | TIMESTAMPTZ | ❌ | Feedback timestamp (default: NOW) |

---

### 10. `app_feedback` - General App Feedback

| Column | Type | Nullable | Description |
|--------|------|----------|-------------|
| `id` | UUID | ❌ | Primary key (auto-generated) |
| `snapshot_id` | UUID | ✅ | FK to snapshots (CASCADE DELETE) |
| `sentiment` | TEXT | ❌ | 'up' or 'down' |
| `comment` | TEXT | ✅ | Optional comment |
| `created_at` | TIMESTAMPTZ | ❌ | Feedback timestamp (default: NOW) |

---

## Memory Tables

### 11. `agent_memory` - Agent Session Memory

| Column | Type | Nullable | Description |
|--------|------|----------|-------------|
| `id` | UUID | ❌ | Primary key (auto-generated) |
| `session_id` | TEXT | ❌ | Session identifier |
| `entry_type` | TEXT | ❌ | Memory type |
| `title` | TEXT | ❌ | Memory title |
| `content` | TEXT | ❌ | Memory content |
| `status` | TEXT | ✅ | Status (default: active) |
| `metadata` | JSONB | ✅ | Additional metadata |
| `created_at` | TIMESTAMPTZ | ❌ | Creation time (default: NOW) |
| `expires_at` | TIMESTAMPTZ | ✅ | Expiration time |

---

### 12. `assistant_memory` - Assistant Context Memory

| Column | Type | Nullable | Description |
|--------|------|----------|-------------|
| `id` | UUID | ❌ | Primary key (auto-generated) |
| `scope` | TEXT | ❌ | Memory scope |
| `key` | TEXT | ❌ | Memory key |
| `user_id` | UUID | ✅ | User identifier |
| `content` | TEXT | ❌ | Memory content |
| `created_at` | TIMESTAMPTZ | ❌ | Creation time (default: NOW) |
| `updated_at` | TIMESTAMPTZ | ❌ | Last update (default: NOW) |
| `expires_at` | TIMESTAMPTZ | ✅ | Expiration time |

---

### 13. `eidolon_memory` - Eidolon SDK Memory

| Column | Type | Nullable | Description |
|--------|------|----------|-------------|
| `id` | UUID | ❌ | Primary key (auto-generated) |
| `scope` | TEXT | ❌ | Memory scope |
| `key` | TEXT | ❌ | Memory key |
| `user_id` | UUID | ✅ | User identifier |
| `content` | TEXT | ❌ | Memory content |
| `created_at` | TIMESTAMPTZ | ❌ | Creation time (default: NOW) |
| `updated_at` | TIMESTAMPTZ | ❌ | Last update (default: NOW) |
| `expires_at` | TIMESTAMPTZ | ✅ | Expiration time |

---

### 14. `cross_thread_memory` - Cross-Thread Shared Memory

| Column | Type | Nullable | Description |
|--------|------|----------|-------------|
| `id` | UUID | ❌ | Primary key (auto-generated) |
| `scope` | TEXT | ❌ | Memory scope |
| `key` | TEXT | ❌ | Memory key |
| `user_id` | UUID | ✅ | User identifier |
| `content` | TEXT | ❌ | Memory content |
| `created_at` | TIMESTAMPTZ | ❌ | Creation time (default: NOW) |
| `updated_at` | TIMESTAMPTZ | ❌ | Last update (default: NOW) |
| `expires_at` | TIMESTAMPTZ | ✅ | Expiration time |

---

## Utility Tables

### 15. `block_jobs` - Async Job Queue

| Column | Type | Nullable | Description |
|--------|------|----------|-------------|
| `id` | UUID | ❌ | Primary key |
| `status` | TEXT | ❌ | pending/running/succeeded/failed |
| `request_body` | JSONB | ❌ | Job payload |
| `result` | JSONB | ✅ | Job result |
| `error` | TEXT | ✅ | Error message if failed |
| `created_at` | TIMESTAMPTZ | ❌ | Job creation (default: NOW) |
| `updated_at` | TIMESTAMPTZ | ❌ | Last update (default: NOW) |

---

### 16. `triad_jobs` - Triad Pipeline Jobs

| Column | Type | Nullable | Description |
|--------|------|----------|-------------|
| `id` | UUID | ❌ | Primary key (auto-generated) |
| `snapshot_id` | UUID | ❌ | FK to snapshots (CASCADE DELETE) |
| `kind` | TEXT | ❌ | Job type (default: triad) |
| `status` | TEXT | ❌ | queued/running/ok/error (default: queued) |
| `created_at` | TIMESTAMPTZ | ❌ | Job creation (default: NOW) |

---

### 17. `http_idem` - HTTP Idempotency Cache

| Column | Type | Nullable | Description |
|--------|------|----------|-------------|
| `key` | TEXT | ❌ | Primary key (idempotency key) |
| `status` | INTEGER | ❌ | HTTP status code |
| `body` | JSONB | ❌ | Response body |
| `created_at` | TIMESTAMPTZ | ❌ | Cache time (default: NOW) |

---

### 18. `places_cache` - Google Places Cache

| Column | Type | Nullable | Description |
|--------|------|----------|-------------|
| `place_id` | TEXT | ❌ | Primary key (Google Place ID) |
| `formatted_hours` | JSONB | ✅ | Formatted business hours |
| `cached_at` | TIMESTAMPTZ | ❌ | Cache timestamp |
| `access_count` | INTEGER | ❌ | Access counter (default: 0) |

---

### 19. `travel_disruptions` - Airport Delay Data

| Column | Type | Nullable | Description |
|--------|------|----------|-------------|
| `id` | UUID | ❌ | Primary key (auto-generated) |
| `country_code` | TEXT | ❌ | Country (default: US) |
| `airport_code` | TEXT | ❌ | IATA airport code |
| `airport_name` | TEXT | ✅ | Airport full name |
| `delay_minutes` | INTEGER | ✅ | Delay duration (default: 0) |
| `ground_stops` | JSONB | ✅ | Ground stop data (default: []) |
| `ground_delay_programs` | JSONB | ✅ | GDP data (default: []) |
| `closure_status` | TEXT | ✅ | Airport status (default: open) |
| `delay_reason` | TEXT | ✅ | Delay explanation |
| `ai_summary` | TEXT | ✅ | AI-generated summary |
| `impact_level` | TEXT | ✅ | Impact level (default: none) |
| `data_source` | TEXT | ❌ | Data source (default: FAA) |
| `last_updated` | TIMESTAMPTZ | ❌ | Last update (default: NOW) |
| `next_update_at` | TIMESTAMPTZ | ✅ | Next scheduled update |

---

### 20. `llm_venue_suggestions` - AI Venue Discovery

| Column | Type | Nullable | Description |
|--------|------|----------|-------------|
| `suggestion_id` | UUID | ❌ | Primary key (auto-generated) |
| `suggested_at` | TIMESTAMPTZ | ❌ | Suggestion time (default: NOW) |
| `model_name` | TEXT | ❌ | Which LLM suggested it |
| `ranking_id` | UUID | ✅ | FK to rankings |
| `venue_name` | TEXT | ❌ | Suggested venue name |
| `suggested_category` | TEXT | ✅ | Suggested category |
| `llm_reasoning` | TEXT | ✅ | Why LLM suggested it |
| `validation_status` | TEXT | ❌ | pending/approved/rejected (default: pending) |
| `place_id_found` | TEXT | ✅ | Google Place ID if validated |
| `venue_id_created` | UUID | ✅ | FK to venue_catalog if created |
| `validated_at` | TIMESTAMPTZ | ✅ | Validation timestamp |
| `rejection_reason` | TEXT | ✅ | Why rejected |
| `llm_analysis` | JSONB | ✅ | LLM analysis payload |

---

### 21. `venue_events` - Venue Event Calendar

| Column | Type | Nullable | Description |
|--------|------|----------|-------------|
| `id` | UUID | ❌ | Primary key (auto-generated) |
| `venue_id` | UUID | ✅ | FK to venue_catalog |
| `place_id` | TEXT | ✅ | Google Place ID |
| `title` | TEXT | ❌ | Event name |
| `starts_at` | TIMESTAMPTZ | ✅ | Event start time |
| `ends_at` | TIMESTAMPTZ | ✅ | Event end time |
| `lat` | DOUBLE PRECISION | ✅ | Event latitude |
| `lng` | DOUBLE PRECISION | ✅ | Event longitude |
| `source` | TEXT | ❌ | Event data source |
| `radius_m` | INTEGER | ✅ | Event radius in meters |
| `created_at` | TIMESTAMPTZ | ❌ | Record creation (default: NOW) |
| `updated_at` | TIMESTAMPTZ | ❌ | Last update (default: NOW) |

---

## Relationships Diagram

```
┌─────────────────────┐
│     snapshots       │ ← Core context capture
└─────────────────────┘
         │ 1
         │
         ├─────────────┐
         │ 1:1         │ 1:N
         ▼             ▼
┌─────────────┐  ┌──────────────┐
│ strategies  │  │  rankings    │
└─────────────┘  └──────────────┘
                        │ 1
                        │ 1:N
                        ▼
                ┌────────────────────────┐
                │ ranking_candidates     │
                └────────────────────────┘
                        │
                        │ N:1
                        ▼
                ┌────────────────┐
                │ venue_catalog  │ ← Master venue DB
                └────────────────┘
                        │ 1
                        │ 1:1
                        ▼
                ┌────────────────┐
                │ venue_metrics  │
                └────────────────┘
```

---

**Total Tables:** 21  
**Total Columns:** 300+  
**Database Size:** ~50MB (production)
