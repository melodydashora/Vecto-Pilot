<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vecto Pilotâ„¢ - README</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            line-height: 1.6;
            color: #1a1a1a;
            background: #ffffff;
            padding: 40px 20px;
            max-width: 1200px;
            margin: 0 auto;
        }
        h1 { 
            color: #0066cc;
            font-size: 2.5em;
            margin: 30px 0 20px 0;
            padding-bottom: 10px;
            border-bottom: 3px solid #0066cc;
        }
        h2 {
            color: #0077dd;
            font-size: 1.8em;
            margin: 25px 0 15px 0;
            padding-bottom: 8px;
            border-bottom: 2px solid #e0e0e0;
        }
        h3 {
            color: #333;
            font-size: 1.4em;
            margin: 20px 0 10px 0;
        }
        h4 {
            color: #555;
            font-size: 1.1em;
            margin: 15px 0 8px 0;
        }
        p { margin: 12px 0; }
        code {
            background: #f5f5f5;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Courier New', Courier, monospace;
            font-size: 0.9em;
            color: #d63384;
        }
        pre {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-left: 4px solid #0066cc;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
            margin: 15px 0;
            font-family: 'Courier New', Courier, monospace;
            font-size: 0.9em;
            line-height: 1.4;
        }
        pre code {
            background: none;
            padding: 0;
            color: #212529;
        }
        ul, ol {
            margin: 12px 0 12px 30px;
        }
        li { margin: 6px 0; }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background: white;
        }
        th, td {
            border: 1px solid #dee2e6;
            padding: 12px;
            text-align: left;
        }
        th {
            background: #0066cc;
            color: white;
            font-weight: 600;
        }
        tr:nth-child(even) {
            background: #f8f9fa;
        }
        blockquote {
            border-left: 4px solid #ffc107;
            background: #fff3cd;
            padding: 15px 20px;
            margin: 15px 0;
            color: #856404;
        }
        .warning {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 15px;
            margin: 15px 0;
        }
        .success {
            background: #d1e7dd;
            border-left: 4px solid #198754;
            padding: 15px;
            margin: 15px 0;
        }
        .info {
            background: #cfe2ff;
            border-left: 4px solid #0d6efd;
            padding: 15px;
            margin: 15px 0;
        }
        hr {
            border: none;
            border-top: 2px solid #e0e0e0;
            margin: 30px 0;
        }
        @media print {
            body { padding: 20px; }
            h1, h2, h3 { page-break-after: avoid; }
            pre, table { page-break-inside: avoid; }
        }
    </style>
</head>
<body>

<h1>Vecto Pilotâ„¢ - Strategic Rideshare Assistant</h1>

<p>**Identity**: Vecto Pilotâ„¢ powered by Eidolon (Claude Sonnet 4.5 Enhanced SDK)  </p>
<p>**Version**: 4.5.0  </p>
<p>**Architecture**: Multi-server with ML capture system  </p>
<p>**AI Model**: Multi-provider LLM router (Gemini 2.5 Pro primary, GPT-5 + Claude fallbacks)</p>

<hr>

<h2>âš ï¸ CRITICAL DEVELOPMENT RULE</h2>

<p>**DO NOT perform rework or break existing flow without reviewing ARCHITECTURE.md first.**</p>

<p>All system design decisions, guards, and architectural patterns are documented in <code>ARCHITECTURE.md</code>. Before making any changes to core logic, pipelines, or data flow:</p>

<p>1. **Read ARCHITECTURE.md** - Understand the existing design and rationale</p>
<p>2. **Verify guards are in place** - Don't recreate protections that already exist</p>
<p>3. **Follow single-path principles** - No fallbacks in triad pipeline (documented)</p>
<p>4. **Respect zero-hardcoding policy** - All data must reconcile to database sources</p>

<p>This prevents costly rework and maintains system integrity.</p>

<hr>

<h2>ğŸ¤– AI Models - CURRENT PRODUCTION CONFIG</h2>

<p>&gt; **ğŸ“‹ See [MODEL.md](./MODEL.md)** for complete model specifications, API details, parameter constraints, and deprecation notices.</p>

<p>&gt; **âš ï¸ IMPORTANT FOR AI ASSISTANTS**: These models were released in 2025 (after most training cutoffs). The information below is tested and verified as of October 8, 2025. Trust these exact model names and parameters - don't second-guess them based on older training data.</p>

<hr>

<h2>ğŸ§  STRATEGY GENERATOR - SINGLE SOURCE OF TRUTH</h2>

<p>**Purpose**: Auto-generate 2-3 sentence strategic overviews when snapshots are created</p>

<h3>Current Configuration (October 5, 2025)</h3>
<li>**Model**: <code>claude-opus-4-1-20250805</code> (Claude Opus 4.1)</li>
<li>**Why Opus 4.1?**: Superior strategic thinking and reasoning (74.5% SWE-bench vs 72.5% Opus 4)</li>
<li>**Temperature**: <code>0.0</code> (most deterministic/tightest possible)</li>
<li>**Max Tokens**: <code>500</code> (sufficient for 2-3 sentences)</li>
<li>**Top P**: Not specified (defaults to 1.0)</li>
<li>**Extended Thinking**: âŒ Disabled (not needed for short strategic summaries)</li>

<h3>Implementation</h3>
<pre><code>
<p>// server/lib/strategy-generator.js</p>
<p>const strategyText = await callClaude({</p>
<p>  system: systemPrompt,</p>
<p>  user: userPrompt,</p>
<p>  max_tokens: 500,</p>
<p>  temperature: 0.0  // Tightest temperature for consistency</p>
<p>});</p>
<pre><code>

<h3>Model Adapter Configuration</h3>
<pre><code>
<p>// server/lib/adapters/anthropic-claude.js</p>
<p>model = process.env.CLAUDE_MODEL || "claude-opus-4-1-20250805"</p>
<pre><code>

<h3>Environment Variable</h3>
<pre><code>
<p>CLAUDE_MODEL=claude-opus-4-1-20250805</p>
<pre><code>

<h3>Extended Thinking Notes</h3>
<li>**Not used for strategy generation** (overkill for 2-3 sentences)</li>
<li>**When to use extended thinking**: Complex multi-step reasoning, advanced coding, agentic workflows</li>
<li>**Temperature limitation**: Extended thinking does NOT support temperature adjustments</li>
<li>**Only top_p adjustable**: Must be 0.95-1.0 when extended thinking is enabled</li>
<li>**Optimal budget_tokens**: 4K-32K for most tasks (diminishing returns above 32K)</li>

<hr>

<h3>Primary Model (Fastest - 22.4s response time)</h3>
<p>**Google Gemini 2.5 Pro**</p>
<li>**Model ID**: <code>gemini-2.5-pro</code></li>
<li>**Endpoint**: <code>https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-pro:generateContent</code></li>
<li>**API Key**: <code>process.env.GEMINI_API_KEY</code></li>
<li>**Parameters**: </li>
<p>  <pre><code></p>
<p>  {</p>
<p>    "generationConfig": {</p>
<p>      "maxOutputTokens": 2048,</p>
<p>      "temperature": 0.2</p>
<p>    }</p>
<p>  }</p>
<p>  <pre><code></p>
<li>**Context**: 1M tokens (2M coming soon)</li>
<li>**Released**: June 2025</li>

<h3>Fallback #1 (27.7s response time)</h3>
<p>**OpenAI GPT-5**</p>
<li>**Model ID**: <code>gpt-5</code></li>
<li>**Endpoint**: <code>https://api.openai.com/v1/chat/completions</code></li>
<li>**API Key**: <code>process.env.OPENAI_API_KEY</code></li>
<li>**Parameters**:</li>
<p>  <pre><code></p>
<p>  {</p>
<p>    "model": "gpt-5",</p>
<p>    "max_completion_tokens": 2048,</p>
<p>    "reasoning_effort": "minimal"</p>
<p>  }</p>
<p>  <pre><code></p>
<li>**Context**: 272K input / 128K output tokens</li>
<li>**Released**: August 7, 2025</li>
<li>**Note**: Supports <code>reasoning_effort</code> (<code>minimal</code>, <code>low</code>, <code>medium</code>, <code>high</code>). Does NOT support <code>temperature</code>, <code>top_p</code>, <code>frequency_penalty</code>, or <code>presence_penalty</code></li>

<h3>Fallback #2 (38.8s response time)</h3>
<p>**Anthropic Claude Sonnet 4.5**</p>
<li>**Model ID**: <code>claude-sonnet-4-5-20250929</code> â­ **This is the official Sonnet model used in production**</li>
<li>**Endpoint**: <code>https://api.anthropic.com/v1/messages</code></li>
<li>**API Key**: <code>process.env.ANTHROPIC_API_KEY</code></li>
<li>**Required Headers**:</li>
<p>  <pre><code></p>
<p>  x-api-key: YOUR_KEY</p>
<p>  anthropic-version: 2023-06-01</p>
<p>  <pre><code></p>
<li>**Parameters**:</li>
<p>  <pre><code></p>
<p>  {</p>
<p>    "model": "claude-sonnet-4-5-20250929",</p>
<p>    "max_tokens": 64000,</p>
<p>    "system": "SYSTEM_PROMPT"</p>
<p>  }</p>
<p>  <pre><code></p>
<li>**Context**: 200K tokens (1M with beta header)</li>
<li>**Released**: September 29, 2025</li>
<li>**âš ï¸ Important**: Use **raw HTTP** instead of <code>@anthropic-ai/sdk</code> - the SDK doesn't recognize Claude 4.5 yet and will return 404. See <code>server/lib/anthropic-extended.js</code> for working implementation.</li>

<h3>Router Configuration</h3>

<p>&gt; **ğŸ“‹ See [MODEL.md](./MODEL.md)** for pinned model IDs and monthly verification command.</p>

<pre><code>
<p>PREFERRED_MODEL=google:gemini-2.5-pro</p>
<p>FALLBACK_MODELS=openai:gpt-5,anthropic:claude-sonnet-4-5-20250929</p>
<p>LLM_TOTAL_BUDGET_MS=60000  # 60 seconds total timeout</p>
<pre><code>

<p>**Full documentation**: See <code>docs/reference/LLM_MODELS_REFERENCE.md</code> for code examples and update protocol.</p>

<hr>

<h2>ğŸš€ Quick Start</h2>

<h3>1. Add Required Secrets to Replit</h3>

<p>Navigate to the Secrets tab and add:</p>

<li>**<code>ANTHROPIC_API_KEY</code>** - Your Claude API key from Anthropic</li>
<li>**<code>AGENT_TOKEN</code>** - Generate with: <code>openssl rand -hex 32</code></li>
<li>**<code>DATABASE_URL</code>** - PostgreSQL connection string (auto-configured in Replit)</li>

<h3>1.1. Verify/Fix Claude Model Configuration</h3>

<p>If you need to update the Claude model in your <code>.env</code> file to use the verified Sonnet 4.5 model:</p>

<p>**Using Shell (Recommended):**</p>
<pre><code>
<h1>Update CLAUDE_MODEL to verified Sonnet 4.5</h1>
<p>sed -i 's/CLAUDE_MODEL=.*/CLAUDE_MODEL=claude-sonnet-4-5-20250929/' .env</p>
<pre><code>

<p>**Manual Method:**</p>
<li>Open <code>.env</code> file in editor</li>
<li>Change <code>CLAUDE_MODEL</code> to <code>claude-sonnet-4-5-20250929</code></li>
<li>Save and restart the workflow</li>

<h3>1.2. Research Latest AI Models (Optional)</h3>

<p>Use Perplexity AI to automatically discover the newest flagship models and their parameters:</p>

<pre><code>
<h1>Run model research (requires PERPLEXITY_API_KEY in .env)</h1>
<p>node tools/research/model-discovery.mjs</p>
<pre><code>

<p>This generates a comprehensive JSON report with:</p>
<li>Latest model IDs and API endpoints</li>
<li>Supported parameters and constraints</li>
<li>Deprecated models and replacements</li>
<li>Citations from official sources</li>

<p>**Output**: <code>tools/research/model-research-YYYY-MM-DD.json</code></p>

<p>See <code>tools/research/README.md</code> for detailed usage instructions for both SDK and HTML/frontend updates.</p>

<h3>2. Click Run</h3>

<p>The system will automatically:</p>
<li>Start Gateway Server on port 5000 (public)</li>
<li>Start Eidolon SDK on port 3101 (internal)</li>
<li>Initialize PostgreSQL database with ML tables</li>
<li>Enable Replit Assistant override</li>
<li>Begin serving your React application</li>

<hr>

<h2>ğŸ—ï¸ System Architecture</h2>

<h3>**Data Architecture Principles**</h3>

<p>**Database-Driven Reconciliation - Zero Hardcoding Policy**</p>

<p>This application follows a strict **database reconciliation model** where all location data, venue information, and model configurations are stored in and retrieved from the database. **No hardcoded locations, coordinates, model names, or business logic constants are permitted in the codebase.**</p>

<p>**Core Principles:**</p>
<p>1. **All locations are database records** - Venue coordinates, addresses, and metadata live in PostgreSQL tables</p>
<p>2. **Models configured via environment variables** - AI model names, API endpoints, and parameters are <code>.env</code> driven</p>
<p>3. **Dynamic reconciliation** - The app queries the database for current state, never assumes static data</p>
<p>4. **No magic strings** - Location names, categories, and filters are database-driven, not code constants</p>
<p>5. **Live data only** - GPS coordinates, weather, timezone, and context are fetched in real-time</p>

<p>**What This Means:**</p>
<li>âŒ **Never** hardcode <code>if (city === "Dallas")</code> or <code>lat: 32.776</code> in code</li>
<li>âœ… **Always** query database: <code>SELECT * FROM venues WHERE city = $1</code></li>
<li>âŒ **Never** hardcode <code>model: "gpt-4"</code> in code  </li>
<li>âœ… **Always** use env vars: <code>process.env.OPENAI_MODEL</code></li>
<li>âŒ **Never** assume static venue catalogs in code</li>
<li>âœ… **Always** reconcile against live database state</li>

<p>This architecture ensures the app scales dynamically as new venues are added to the database and adapts automatically when model configurations change via environment variables.</p>

<hr>

<h3>**Multi-Server Design**</h3>

<pre><code>
<p>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</p>
<p>â”‚  Gateway (Port 5000) - Public Interface                â”‚</p>
<p>â”‚  â”œâ”€ Reverse proxy to SDK                               â”‚</p>
<p>â”‚  â”œâ”€ Vite dev server (HMR)                              â”‚</p>
<p>â”‚  â”œâ”€ Static file serving                                â”‚</p>
<p>â”‚  â””â”€ SDK health watchdog                                â”‚</p>
<p>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</p>
<p>                   â”‚</p>
<p>                   â–¼</p>
<p>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</p>
<p>â”‚  Eidolon SDK (Port 3101) - Internal Backend            â”‚</p>
<p>â”‚  â”œâ”€ Complete Replit Assistant override                 â”‚</p>
<p>â”‚  â”œâ”€ Business logic &amp; API endpoints                     â”‚</p>
<p>â”‚  â”œâ”€ Claude API integration                             â”‚</p>
<p>â”‚  â””â”€ ML data capture                                    â”‚</p>
<p>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</p>
<p>                   â”‚</p>
<p>                   â–¼</p>
<p>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</p>
<p>â”‚  PostgreSQL Database                                    â”‚</p>
<p>â”‚  â”œâ”€ snapshots (context records)                        â”‚</p>
<p>â”‚  â”œâ”€ rankings (recommendation sets)                     â”‚</p>
<p>â”‚  â”œâ”€ ranking_candidates (individual blocks)             â”‚</p>
<p>â”‚  â””â”€ actions (user interactions)                        â”‚</p>
<p>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</p>
<pre><code>

<hr>

<h2>ğŸ“Š Core Features</h2>

<h3>**1. Smart Block Recommendations**</h3>
<li>AI-powered location suggestions from Claude Sonnet 4.5</li>
<li>Context-aware (city, weather, time of day, traffic)</li>
<li>Filtered by drive time (0-30 minutes)</li>
<li>Ranked by earnings per mile</li>

<h3>**2. ML Data Capture**</h3>
<li>Automatic context snapshot on GPS refresh</li>
<li>Recommendation tracking (what Claude suggested)</li>
<li>User action logging (view, dwell, click, dismiss)</li>
<li>Prepared for future model training</li>

<h3>**3. Location Intelligence**</h3>
<li>High-accuracy GPS with browser geolocation</li>
<li>Google Maps geocoding (city, state, country)</li>
<li>Timezone resolution</li>
<li>Weather and AQI integration</li>

<h3>**4. Replit Assistant Override**</h3>
<li>Complete replacement of default assistant</li>
<li>Enhanced memory and context awareness</li>
<li>Workspace diagnostics and file operations</li>
<li>Deep thinking engine for complex analysis</li>

<hr>

<h2>ğŸ“ Core Files</h2>

<h3>Infrastructure</h3>
<li>**<code>gateway-server.js</code>** - Public gateway with reverse proxy</li>
<li>**<code>index.js</code>** - Eidolon SDK with AI assistant override</li>
<li>**<code>agent-server.js</code>** - File operations and command execution</li>

<h3>Backend API</h3>
<li>**<code>server/routes/blocks.js</code>** - Smart recommendations with ML capture</li>
<li>**<code>server/routes/location.js</code>** - GPS resolution and snapshot storage</li>
<li>**<code>server/routes/actions.js</code>** - User interaction logging</li>
<li>**<code>server/db/drizzle.js</code>** - Database schema and queries</li>

<h3>Frontend</h3>
<li>**<code>client/src/App.tsx</code>** - Main React application</li>
<li>**<code>client/src/pages/co-pilot.tsx</code>** - Smart blocks UI</li>
<li>**<code>client/src/contexts/location-context-clean.tsx</code>** - GPS state management</li>
<li>**<code>client/src/components/GlobalHeader.tsx</code>** - Universal header component</li>

<h3>Eidolon Enhanced SDK</h3>
<li>**<code>server/eidolon/core/</code>** - AI capabilities (memory, context, deep thinking)</li>
<li>**<code>server/eidolon/tools/</code>** - Diagnostics and workspace tools</li>
<li>**<code>server/eidolon/config.ts</code>** - Centralized configuration</li>

<hr>

<h2>ğŸ”§ API Endpoints</h2>

<h3>ğŸ“ Location Services</h3>

<h4><code>GET /api/location/resolve</code></h4>
<p>Geocode GPS coordinates to location details with timezone</p>

<p>**Parameters**:</p>
<pre><code>
<p>lat: number (required) - Latitude</p>
<p>lng: number (required) - Longitude</p>
<pre><code>

<p>**Response**:</p>
<pre><code>
<p>{</p>
<p>  "city": "Frisco",</p>
<p>  "state": "TX",</p>
<p>  "country": "United States",</p>
<p>  "timeZone": "America/Chicago",</p>
<p>  "formattedAddress": "1701 Timber Ridge Dr, Frisco, TX 75036, USA"</p>
<p>}</p>
<pre><code>

<h4><code>GET /api/location/geocode/forward</code></h4>
<p>Convert city name to coordinates</p>

<p>**Parameters**:</p>
<pre><code>
<p>city: string (required) - City name (e.g., "Dallas,TX")</p>
<pre><code>

<p>**Response**:</p>
<pre><code>
<p>{</p>
<p>  "city": "Dallas",</p>
<p>  "state": "TX",</p>
<p>  "country": "United States",</p>
<p>  "coordinates": {</p>
<p>    "lat": 32.7767,</p>
<p>    "lng": -96.7970</p>
<p>  },</p>
<p>  "formattedAddress": "Dallas, TX, USA"</p>
<p>}</p>
<pre><code>

<h4><code>GET /api/location/weather</code></h4>
<p>Get current weather conditions</p>

<p>**Parameters**:</p>
<pre><code>
<p>lat: number (required)</p>
<p>lng: number (required)</p>
<pre><code>

<p>**Response**:</p>
<pre><code>
<p>{</p>
<p>  "available": true,</p>
<p>  "temperature": 69,</p>
<p>  "feelsLike": 69,</p>
<p>  "conditions": "Clear",</p>
<p>  "description": "clear sky",</p>
<p>  "humidity": 76,</p>
<p>  "windSpeed": 9,</p>
<p>  "precipitation": 0,</p>
<p>  "icon": "01n"</p>
<p>}</p>
<pre><code>

<h4><code>GET /api/location/airquality</code></h4>
<p>Get current air quality index (AQI)</p>

<p>**Parameters**:</p>
<pre><code>
<p>lat: number (required)</p>
<p>lng: number (required)</p>
<pre><code>

<p>**Response**:</p>
<pre><code>
<p>{</p>
<p>  "available": true,</p>
<p>  "aqi": 78,</p>
<p>  "category": "Good air quality",</p>
<p>  "dominantPollutant": "o3",</p>
<p>  "healthRecommendations": {},</p>
<p>  "dateTime": "2025-10-05T12:00:00Z",</p>
<p>  "regionCode": "us"</p>
<p>}</p>
<pre><code>

<h4><code>POST /api/location/snapshot</code></h4>
<p>Save context snapshot to database (SnapshotV1 format)</p>

<p>**Request Body**:</p>
<pre><code>
<p>{</p>
<p>  "snapshot_id": "uuid",</p>
<p>  "user_id": "uuid",</p>
<p>  "device_id": "uuid",</p>
<p>  "session_id": "uuid",</p>
<p>  "created_at": "2025-10-07T12:00:00Z",</p>
<p>  "coord": {</p>
<p>    "lat": 33.12886,</p>
<p>    "lng": -96.87570,</p>
<p>    "accuracyMeters": 85,</p>
<p>    "source": "gps"</p>
<p>  },</p>
<p>  "resolved": {</p>
<p>    "city": "Frisco",</p>
<p>    "state": "TX",</p>
<p>    "country": "United States",</p>
<p>    "timezone": "America/Chicago",</p>
<p>    "formattedAddress": "1701 Timber Ridge Dr, Frisco, TX 75036, USA"</p>
<p>  },</p>
<p>  "time_context": {</p>
<p>    "local_iso": "2025-10-07T09:00:00-05:00",</p>
<p>    "dow": 1,</p>
<p>    "hour": 9,</p>
<p>    "is_weekend": false,</p>
<p>    "day_part_key": "morning"</p>
<p>  },</p>
<p>  "weather": {</p>
<p>    "tempF": 69,</p>
<p>    "conditions": "Clear",</p>
<p>    "description": "clear sky"</p>
<p>  },</p>
<p>  "air": {</p>
<p>    "aqi": 78,</p>
<p>    "category": "Good air quality"</p>
<p>  },</p>
<p>  "device": {</p>
<p>    "ua": "Mozilla/5.0...",</p>
<p>    "platform": "web"</p>
<p>  },</p>
<p>  "permissions": {</p>
<p>    "geolocation": "granted"</p>
<p>  }</p>
<p>}</p>
<pre><code>

<p>**Response**:</p>
<pre><code>
<p>{</p>
<p>  "ok": true,</p>
<p>  "snapshot_id": "uuid",</p>
<p>  "h3_r8": "8826c87297fffff",</p>
<p>  "airport_context": {</p>
<p>    "airport_code": "DFW",</p>
<p>    "distance_miles": 18.6,</p>
<p>    "delay_minutes": 30</p>
<p>  }</p>
<p>}</p>
<pre><code>

<hr>

<h3>ğŸ¯ Smart Blocks &amp; Co-Pilot</h3>

<h4><code>GET /api/blocks</code></h4>
<p>Get AI-powered location recommendations</p>

<p>**Parameters**:</p>
<pre><code>
<p>lat: number (required)</p>
<p>lng: number (required)</p>
<p>userId: string (optional, default: 'default')</p>
<p>minDistance: number (optional, default: 8) - Min drive time in minutes</p>
<p>maxDistance: number (optional, default: 10) - Max drive time in minutes</p>
<p>llmModel: string (optional) - Testing: 'gemini', 'gpt-5', 'claude'</p>
<p>llmParam: string (optional) - Testing parameter value</p>
<pre><code>

<p>**Headers**:</p>
<pre><code>
<p>X-Snapshot-Id: string (optional) - Anchor to specific snapshot</p>
<pre><code>

<p>**Response**:</p>
<pre><code>
<p>{</p>
<p>  "blocks": [</p>
<p>    {</p>
<p>      "id": "block-1",</p>
<p>      "name": "DFW Terminal C",</p>
<p>      "from": "Frisco, TX",</p>
<p>      "to": "DFW Terminal C",</p>
<p>      "distance": "18.6 miles",</p>
<p>      "estimatedTime": "22 min",</p>
<p>      "trafficDelay": 3,</p>
<p>      "construction": false,</p>
<p>      "incidents": 0,</p>
<p>      "congestionLevel": "light",</p>
<p>      "earnings": {</p>
<p>        "estimatedFare": 35,</p>
<p>        "timeCost": 12,</p>
<p>        "netValue": 23</p>
<p>      },</p>
<p>      "mapLink": "https://maps.google.com/..."</p>
<p>    }</p>
<p>  ],</p>
<p>  "meta": {</p>
<p>    "count": 6,</p>
<p>    "radius": "10 minutes",</p>
<p>    "center": { "lat": 33.12886, "lng": -96.87570 },</p>
<p>    "minRate": 15</p>
<p>  }</p>
<p>}</p>
<pre><code>

<p>**Side Effects**: Creates <code>ranking</code> and <code>ranking_candidates</code> records in database</p>

<h4><code>POST /api/blocks-merged</code></h4>
<p>Merged strategy using Planner (GPT-5) â†’ Validator (Gemini) â†’ Explainer (Claude)</p>

<p>**Request Body**:</p>
<pre><code>
<p>{</p>
<p>  "userId": "demo",</p>
<p>  "origin": {</p>
<p>    "lat": 33.12886,</p>
<p>    "lng": -96.87570</p>
<p>  },</p>
<p>  "currentTime": "2025-10-05T12:00:00Z",</p>
<p>  "shiftDuration": 8,</p>
<p>  "maxDriveDistance": 15,</p>
<p>  "stream": false</p>
<p>}</p>
<pre><code>

<p>**Response**:</p>
<pre><code>
<p>{</p>
<p>  "strategy": "Focus on airport terminals during early morning...",</p>
<p>  "blocks": [</p>
<p>    {</p>
<p>      "id": "venue-uuid",</p>
<p>      "name": "DFW Terminal C",</p>
<p>      "address": "Dallas/Fort Worth International Airport",</p>
<p>      "lat": 32.8998,</p>
<p>      "lng": -97.0403,</p>
<p>      "driveTime": 22,</p>
<p>      "distance": "18.6 miles",</p>
<p>      "estimatedEarnings": 35,</p>
<p>      "urgency": "high",</p>
<p>      "reasoning": "High business travel volume...",</p>
<p>      "proTips": ["Stage near Departures", "Watch for surge alerts"]</p>
<p>    }</p>
<p>  ],</p>
<p>  "correlationId": "abc123def",</p>
<p>  "elapsed_ms": 4500,</p>
<p>  "model_route": "gpt5â†’geminiâ†’claude",</p>
<p>  "validation": {</p>
<p>    "status": "valid",</p>
<p>    "schema_check": "passed"</p>
<p>  }</p>
<p>}</p>
<pre><code>

<h4><code>GET /api/blocks-discovery</code></h4>
<p>Hybrid discovery: Seeded venues + AI suggestions validated by Places API</p>

<p>**Parameters**:</p>
<pre><code>
<p>lat: number (required)</p>
<p>lng: number (required)</p>
<p>userId: string (optional)</p>
<p>snapshotId: string (optional)</p>
<pre><code>

<p>**Response**:</p>
<pre><code>
<p>{</p>
<p>  "blocks": [...],</p>
<p>  "summary": {</p>
<p>    "totalProjectedEarnings": 180,</p>
<p>    "avgHourlyRate": 22.50</p>
<p>  },</p>
<p>  "metadata": {</p>
<p>    "generatedAt": "2025-10-05T12:00:00Z",</p>
<p>    "context": {</p>
<p>      "time": "morning",</p>
<p>      "weather": "69Â°F Clear"</p>
<p>    },</p>
<p>    "driverLocation": {</p>
<p>      "lat": 33.12886,</p>
<p>      "lng": -96.87570</p>
<p>    }</p>
<p>  }</p>
<p>}</p>
<pre><code>

<hr>

<h3>ğŸ“Š User Actions &amp; ML Capture</h3>

<h4><code>POST /api/actions</code></h4>
<p>Log user interaction for ML training</p>

<p>**Request Body**:</p>
<pre><code>
<p>{</p>
<p>  "ranking_id": "uuid",</p>
<p>  "action": "block_selected",</p>
<p>  "block_id": "venue-uuid",</p>
<p>  "dwell_ms": 3500,</p>
<p>  "from_rank": 1,</p>
<p>  "user_id": "uuid",</p>
<p>  "raw": {}</p>
<p>}</p>
<pre><code>

<p>**Headers**:</p>
<pre><code>
<p>X-Idempotency-Key: string (optional) - Prevent duplicate actions</p>
<pre><code>

<p>**Response**:</p>
<pre><code>
<p>{</p>
<p>  "success": true,</p>
<p>  "action_id": "uuid"</p>
<p>}</p>
<pre><code>

<p>**Action Types**: <code>view</code>, <code>dwell</code>, <code>block_selected</code>, <code>block_clicked</code>, <code>block_dismissed</code></p>

<hr>

<h3>ğŸ”§ Agent Server (Port 43717)</h3>

<p>**Authentication**: All requests require <code>x-agent-token</code> header</p>

<h4><code>GET /agent/health</code></h4>
<p>Health check</p>

<p>**Response**:</p>
<pre><code>
<p>{</p>
<p>  "ok": true,</p>
<p>  "base": "/home/runner/workspace",</p>
<p>  "time": "2025-10-05T12:00:00Z",</p>
<p>  "version": "2.1.0",</p>
<p>  "environment": "replit"</p>
<p>}</p>
<pre><code>

<h4><code>GET /agent/info</code></h4>
<p>Get server capabilities and limits</p>

<p>**Response**:</p>
<pre><code>
<p>{</p>
<p>  "ok": true,</p>
<p>  "version": "2.1.0",</p>
<p>  "features": {</p>
<p>    "read": true,</p>
<p>    "write": true,</p>
<p>    "list": true,</p>
<p>    "shell": true,</p>
<p>    "nodejs": true,</p>
<p>    "database": true,</p>
<p>    "sql": true</p>
<p>  },</p>
<p>  "limits": {</p>
<p>    "maxFileSize": 10485760,</p>
<p>    "commandTimeout": 60000,</p>
<p>    "allowedCommands": ["ls", "cat", "npm", "node", "git", ...]</p>
<p>  },</p>
<p>  "security": {</p>
<p>    "cors": true,</p>
<p>    "rateLimiting": true,</p>
<p>    "pathTraversal": "protected",</p>
<p>    "commandWhitelist": true</p>
<p>  }</p>
<p>}</p>
<pre><code>

<h4><code>POST /agent/fs/read</code></h4>
<p>Read file contents</p>

<p>**Request Body**:</p>
<pre><code>
<p>{</p>
<p>  "path": "server/routes/blocks.js"</p>
<p>}</p>
<pre><code>

<p>**Response**:</p>
<pre><code>
<p>{</p>
<p>  "ok": true,</p>
<p>  "path": "server/routes/blocks.js",</p>
<p>  "content": "import { Router } from 'express'...",</p>
<p>  "size": 5432,</p>
<p>  "modified": "2025-10-05T12:00:00Z"</p>
<p>}</p>
<pre><code>

<h4><code>POST /agent/fs/write</code></h4>
<p>Write file contents</p>

<p>**Request Body**:</p>
<pre><code>
<p>{</p>
<p>  "path": "data/config.json",</p>
<p>  "content": "{\"key\":\"value\"}"</p>
<p>}</p>
<pre><code>

<p>**Response**:</p>
<pre><code>
<p>{</p>
<p>  "ok": true,</p>
<p>  "path": "data/config.json",</p>
<p>  "bytes": 15,</p>
<p>  "timestamp": "2025-10-05T12:00:00Z"</p>
<p>}</p>
<pre><code>

<h4><code>POST /agent/shell</code></h4>
<p>Execute shell command</p>

<p>**Request Body**:</p>
<pre><code>
<p>{</p>
<p>  "cmd": "npm",</p>
<p>  "args": ["install", "lodash"]</p>
<p>}</p>
<pre><code>

<p>**Response**:</p>
<pre><code>
<p>{</p>
<p>  "ok": true,</p>
<p>  "cmd": "npm",</p>
<p>  "args": ["install", "lodash"],</p>
<p>  "stdout": "added 1 package...",</p>
<p>  "stderr": "",</p>
<p>  "executionTime": 2500,</p>
<p>  "truncated": false</p>
<p>}</p>
<pre><code>

<h4><code>POST /agent/sql/query</code></h4>
<p>Execute SQL SELECT query (read-only)</p>

<p>**Request Body**:</p>
<pre><code>
<p>{</p>
<p>  "sql": "SELECT * FROM snapshots LIMIT 5",</p>
<p>  "params": []</p>
<p>}</p>
<pre><code>

<p>**Response**:</p>
<pre><code>
<p>{</p>
<p>  "ok": true,</p>
<p>  "rows": [...],</p>
<p>  "rowCount": 5,</p>
<p>  "command": "SELECT",</p>
<p>  "fields": [</p>
<p>    { "name": "snapshot_id", "dataType": 2950 },</p>
<p>    { "name": "city", "dataType": 1043 }</p>
<p>  ]</p>
<p>}</p>
<pre><code>

<h4><code>POST /agent/sql/execute</code></h4>
<p>Execute SQL statement (INSERT/UPDATE/DELETE)</p>

<p>**Request Body**:</p>
<pre><code>
<p>{</p>
<p>  "sql": "INSERT INTO venue_feedback (venue_id, feedback_type) VALUES ($1, $2)",</p>
<p>  "params": ["uuid", "positive"]</p>
<p>}</p>
<pre><code>

<p>**Response**:</p>
<pre><code>
<p>{</p>
<p>  "ok": true,</p>
<p>  "rows": [],</p>
<p>  "rowCount": 1,</p>
<p>  "command": "INSERT"</p>
<p>}</p>
<pre><code>

<h4><code>GET /agent/sql/tables</code></h4>
<p>List all database tables</p>

<p>**Response**:</p>
<pre><code>
<p>{</p>
<p>  "ok": true,</p>
<p>  "tables": [</p>
<p>    "actions",</p>
<p>    "llm_venue_suggestions",</p>
<p>    "places_cache",</p>
<p>    "ranking_candidates",</p>
<p>    "rankings",</p>
<p>    "snapshots",</p>
<p>    "venue_catalog",</p>
<p>    "venue_feedback",</p>
<p>    "venue_metrics"</p>
<p>  ]</p>
<p>}</p>
<pre><code>

<h4><code>POST /agent/sql/schema</code></h4>
<p>Get table schema information</p>

<p>**Request Body**:</p>
<pre><code>
<p>{</p>
<p>  "table_name": "snapshots"</p>
<p>}</p>
<pre><code>

<p>**Response**:</p>
<pre><code>
<p>{</p>
<p>  "ok": true,</p>
<p>  "schema": [</p>
<p>    {</p>
<p>      "table_name": "snapshots",</p>
<p>      "column_name": "snapshot_id",</p>
<p>      "data_type": "uuid",</p>
<p>      "is_nullable": "NO",</p>
<p>      "column_default": null</p>
<p>    },</p>
<p>    ...</p>
<p>  ],</p>
<p>  "table": "snapshots"</p>
<p>}</p>
<pre><code>

<hr>

<h3>ğŸ¥ Health &amp; Monitoring</h3>

<h4><code>GET /health</code></h4>
<p>SDK health check</p>

<p>**Response**:</p>
<pre><code>
<p>{</p>
<p>  "ok": true,</p>
<p>  "timestamp": "2025-10-05T12:00:00Z"</p>
<p>}</p>
<pre><code>

<hr>

<h2>ğŸ—ƒï¸ Database Schema</h2>

<h3>**snapshots** - Context Records</h3>
<p>Captures GPS, location, weather, and time context on each refresh.</p>

<pre><code>
<p>snapshot_id UUID PRIMARY KEY</p>
<p>user_id TEXT</p>
<p>device_id TEXT</p>
<p>city TEXT           -- "Frisco, TX"</p>
<p>h3_r8 TEXT         -- Geospatial hex index</p>
<p>day_part TEXT      -- "afternoon", "morning", etc.</p>
<p>created_at TIMESTAMP</p>
<pre><code>

<h3>**rankings** - Recommendation Sets</h3>
<p>Stores each set of recommendations from Claude with strategy text.</p>

<pre><code>
<p>ranking_id UUID PRIMARY KEY</p>
<p>snapshot_id UUID â†’ snapshots.snapshot_id</p>
<p>strategy_text TEXT  -- Claude's strategy overview</p>
<p>created_at TIMESTAMP</p>
<pre><code>

<h3>**ranking_candidates** - Individual Blocks</h3>
<p>Each block in a ranking with its position and metrics.</p>

<pre><code>
<p>id SERIAL PRIMARY KEY</p>
<p>ranking_id UUID â†’ rankings.ranking_id</p>
<p>block_id TEXT       -- "The Star in Frisco"</p>
<p>rank INTEGER        -- 1-6 position</p>
<p>earnings_usd DECIMAL</p>
<p>distance_miles DECIMAL</p>
<p>drive_minutes INTEGER</p>
<pre><code>

<h3>**actions** - User Interactions</h3>
<p>Logs what users do with recommendations (view, click, dismiss).</p>

<pre><code>
<p>id SERIAL PRIMARY KEY</p>
<p>action_type TEXT    -- view, dwell, click, dismiss</p>
<p>snapshot_id UUID â†’ snapshots.snapshot_id</p>
<p>ranking_id UUID â†’ rankings.ranking_id</p>
<p>block_id TEXT</p>
<p>dwell_ms INTEGER    -- For dwell actions</p>
<p>created_at TIMESTAMP</p>
<pre><code>

<hr>

<h2>ğŸ“ ML Training Pipeline (Future)</h2>

<p>The current system captures all necessary data for training a custom recommendation model:</p>

<p>**Input Features** (from <code>snapshots</code>):</p>
<li>City, geospatial hex, day part, weather, hour of day</li>

<p>**Candidate Features** (from <code>ranking_candidates</code>):</p>
<li>Block ID, earnings, distance, drive time</li>

<p>**Labels** (from <code>actions</code>):</p>
<li>Click probability, dwell time</li>

<p>**Model Goal**: Predict <code>P(user clicks block | context, candidate features)</code> to re-rank blocks by predicted click probability.</p>

<hr>

<h2>ğŸ› ï¸ Development Commands</h2>

<h3>Start Development Server</h3>
<pre><code>
<h1>Automatically runs on "Run" button</h1>
<p>node gateway-server.js</p>
<pre><code>

<h3>Database Migrations</h3>
<pre><code>
<h1>Run initial migrations</h1>
<p>npm run db:migrate</p>
<pre><code>

<h3>Build for Production</h3>
<pre><code>
<h1>Build React client</h1>
<p>cd client &amp;&amp; npm run build</p>
<pre><code>

<h3>Health Check</h3>
<pre><code>
<h1>Test SDK health</h1>
<p>curl http://127.0.0.1:5000/health</p>
<pre><code>

<hr>

<h2>ğŸš¨ Emergency Recovery</h2>

<p>If the system encounters issues, use the recovery script:</p>

<pre><code>
<p>bash eidolon-recovery.sh</p>
<pre><code>

<p>**Options**:</p>
<p>1. Quick Recovery (port conflicts)</p>
<p>2. Standard Recovery (dependencies)</p>
<p>3. Nuclear Recovery (complete reset)</p>
<p>4. Emergency Mode (minimal fallback)</p>

<hr>

<h2>ğŸ“š Documentation</h2>

<li>**<code>LEXICON.md</code>** - Complete system terminology and architecture</li>
<li>**<code>COMPONENT_ORGANIZATION.md</code>** - UI component mapping and data flow</li>
<li>**<code>EIDOLON_ARCHITECTURE.md</code>** - Eidolon SDK technical architecture</li>
<li>**<code>VECTO_BUILD_DOCUMENTATION.md</code>** - Build history and changes</li>

<hr>

<h2>ğŸ” Security</h2>

<li>**Agent Server**: Token-based auth with command whitelisting</li>
<li>**Rate Limiting**: Gateway enforces API rate limits</li>
<li>**CORS**: Configured for Replit environment</li>
<li>**Database**: Connection pooling with prepared statements</li>
<li>**API Keys**: Stored in Replit Secrets (never in code)</li>

<hr>

<h2>ğŸŒŸ Key Technologies</h2>

<h3>Backend</h3>
<li>**Node.js 22+** - Runtime with native ESM</li>
<li>**Express** - HTTP server framework</li>
<li>**PostgreSQL** - Relational database</li>
<li>**Drizzle ORM** - Type-safe database queries</li>
<li>**Claude Sonnet 4.5** - AI recommendations</li>

<h3>Frontend</h3>
<li>**React 18** - UI framework</li>
<li>**TypeScript** - Type safety</li>
<li>**Vite** - Build tool with HMR</li>
<li>**Tailwind CSS** - Utility-first styling</li>
<li>**shadcn/ui** - Component library</li>
<li>**Wouter** - Lightweight routing</li>

<h3>Infrastructure</h3>
<li>**http-proxy-middleware** - Reverse proxy</li>
<li>**express-rate-limit** - API rate limiting</li>
<li>**H3** - Geospatial indexing</li>
<li>**Zod** - Runtime validation</li>

<hr>

<h2>ğŸ“ˆ Current Status</h2>

<p>**Build**: âœ… Complete  </p>
<p>**ML Infrastructure**: âœ… Active  </p>
<p>**Data Capture**: âœ… Logging real-world interactions  </p>
<p>**AI Recommendations**: âœ… Claude Sonnet 4.5 integrated  </p>
<p>**Database**: âœ… 4 tables capturing context â†’ ranking â†’ action  </p>

<p>**Next Steps**:</p>
<li>Continue capturing real-world data</li>
<li>Build model training pipeline</li>
<li>Deploy custom recommendation model</li>
<li>A/B test Claude vs. custom model</li>

<hr>

<h2>ğŸ‘¥ Support</h2>

<p>For issues or questions about Eidolon Enhanced SDK:</p>
<li>Check <code>EIDOLON_ARCHITECTURE.md</code> for technical details</li>
<li>Review console logs in gateway and SDK</li>
<li>Use emergency recovery script if needed</li>

<hr>

<p>**Vecto Pilotâ„¢** - Strategic Rideshare Assistant powered by **Eidolon (Claude Sonnet 4.5 Enhanced SDK)**</p>

<p>**Last Updated**: October 5, 2025 - Comprehensive API documentation with verbose request/response formats</p>
</body>
</html>
