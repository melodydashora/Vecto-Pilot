# ===============================
# Vecto Pilot — Webservice Deployment Mode
# For Replit Autoscale deployments (HTTP/WebSocket only)
# ===============================
# IMPORTANT: This mode does NOT run background workers
# Background processing should be handled by a separate worker deployment
# ===============================

# -------------------------------
# Deployment Mode
# -------------------------------
APP_MODE=mono
NODE_ENV=production

# -------------------------------
# Server Configuration
# -------------------------------
PORT=5000
GATEWAY_PORT=5000
AGENT_PORT=43717

# -------------------------------
# Service Embedding (Webservice Mode)
# -------------------------------
# Disable spawning SDK and Agent as child processes
# In webservice mode, we embed SDK routes directly into gateway
DISABLE_SPAWN_SDK=1
DISABLE_SPAWN_AGENT=1

# -------------------------------
# API & WebSocket Paths
# -------------------------------
API_PREFIX=/api
AGENT_PREFIX=/agent
WS_PUBLIC_PATH=/agent/ws
SOCKET_IO_PATH=/socket.io

# -------------------------------
# Background Worker Control
# -------------------------------
# Enable background worker for strategy generation
# Worker runs in same process for Reserved VM deployments
ENABLE_BACKGROUND_WORKER=true
USE_LISTEN_MODE=true

# -------------------------------
# Agent Server Base URL
# -------------------------------
AGENT_BASE_URL=http://127.0.0.1:${AGENT_PORT}

# -------------------------------
# Bootstrap Testing (Development Only)
# -------------------------------
# Disable job seeding in production webservice mode
SEED_JOB_ON_BOOT=false

# -------------------------------
# Database Pool Configuration (Autoscale Optimized)
# -------------------------------
# CRITICAL: Reduce pool size for Cloud Run autoscale
# Each instance gets 2 connections max to avoid exceeding Neon's connection limit
# With 50 instances: 50 × 2 = 100 connections (within typical free tier limit)
PG_MAX=2
PG_MIN=0
PG_IDLE_TIMEOUT_MS=30000
