> **Gemini Analysis (2026-02-11):**
> This is the root documentation for the Vecto Pilot application. It outlines the project's purpose (AI-powered rideshare intelligence), key features (Triad pipeline, Smart Blocks, AI Coach), technical stack (React/Node/Postgres/Drizzle/Multiple LLMs), and setup instructions. It serves as the primary entry point for understanding the system's high-level architecture and capabilities.

# Vecto Pilot - AI-Powered Rideshare Intelligence Platform

**Built by AI, For AI-Assisted Drivers.**

> **Project Genesis:** This application is a testament to the capabilities of modern AI software engineering. It was architected and implemented by **Google Gemini 3.0 Pro Preview** and **Anthropic Claude 4.5 Opus**, with rigorous architectural auditing and security hardening provided by **OpenAI GPT-4o/5-series**.

---

## Overview

Vecto Pilot is an AI-native rideshare intelligence platform designed to maximize driver earnings through real-time, data-driven strategic briefings. Unlike traditional "hotspot" apps, Vecto Pilot uses a sophisticated **multi-model AI waterfall** to synthesize weather, traffic, events, and news into actionable, narrative strategies.

It operates globally, requires no hardware integration, and provides a "Co-Pilot" experience via text and voice.

### Key AI-Driven Enhancements

- **TRIAD Waterfall Pipeline**: A parallel processing engine where different AI models handle specialized tasks (Strategy, Briefing, Validation) before consolidating into a final directive.
- **Smart Blocks‚Ñ¢**: Context-aware content blocks that validate venue status, pricing, and "last call" times in real-time.
- **AI Coach (Voice & Text)**: A conversational assistant powered by **OpenAI Realtime API**, capable of holding hands-free voice conversations with drivers about strategy.
- **Semantic Event Deduplication**: Uses LLMs to identify and merge duplicate event listings (e.g., "The Eras Tour" vs "Taylor Swift Concert") across data sources.
- **Self-Healing Infrastructure**: Automated scripts (audited by GPT) that detect and resolve database schema drift and data consistency issues.

---

## Feature Set

### üß† Strategic Intelligence
*   **Daily Briefing**: A synthesized morning report covering weather impact, major traffic incidents, and city-wide event density.
*   **Hourly Strategy**: Tactical "Right Now" guidance generated by **GPT-5.2**, optimized for the next 60 minutes.
*   **Holiday-Aware**: Integrated **Perplexity Sonar Pro** to detect local holidays and adjust demand forecasts accordingly.

### üìç Venue & Location
*   **Real-time Venue Intelligence**: Discovery of bars, clubs, and venues sorted by expense level (`$$$`) and closing times.
*   **Traffic & Safety**: Integration with Google Traffic and local safety corridors to keep drivers out of high-risk gridlock.
*   **Global Scalability**: Works in any city with Google Maps coverage. 6-decimal GPS precision (~11cm) ensures accurate venue matching.

### üó£Ô∏è Driver Experience
*   **Mobile-First UI**: Optimized for quick glances between rides (large tap targets, high contrast).
*   **Voice Mode**: "Talk to Coach" feature allowing two-way voice conversations while driving.
*   **Progressive Enrichment**: UI loads immediately with cached data while AI models enrich details in the background.

---

## Technical Stack

**Frontend**
- **Framework**: React 18
- **Build Tool**: Vite 6.x
- **Language**: TypeScript 5.x
- **Styling**: TailwindCSS 4 + Radix UI Primitives
- **State**: React Query (TanStack) + Context API

**Backend**
- **Runtime**: Node.js 20+
- **Server**: Express.js
- **Database**: PostgreSQL 15+ (managed by Replit)
- **ORM**: Drizzle ORM (Schema-first design)
- **Real-time**: Server-Sent Events (SSE) for text, WebSocket for Voice

**AI & APIs**
- **Orchestrator**: Custom Model Adapter Pattern
- **Models**:
    - **Anthropic Claude 3.5 Sonnet / 4.5 Opus**: High-level strategic reasoning.
    - **Google Gemini 3.0 Pro Preview**: High-volume data synthesis (News, Events).
    - **OpenAI GPT-5.2 / 4o**: Tactical generation and JSON structure enforcement.
    - **Perplexity**: Real-time web research (Holidays, Local News).
- **APIs**: Google Maps Platform (Places, Routes, Solar), OpenWeather.

---

## Setup & Installation

### Prerequisites
- Node.js 20.x or higher
- PostgreSQL Database
- API Keys for: OpenAI, Anthropic, Google Gemini, Google Maps, Perplexity.

### Step-by-Step Instructions

1.  **Clone the Repository**
    ```bash
    git clone https://github.com/your-org/vecto-pilot.git
    cd vecto-pilot
    ```

2.  **Install Dependencies**
    ```bash
    npm install
    ```

3.  **Configure Environment**
    Create a `.env` file in the root directory:
    ```bash
    # Database
    DATABASE_URL="postgresql://user:pass@host:5432/db"

    # AI Providers
    OPENAI_API_KEY="sk-..."
    ANTHROPIC_API_KEY="sk-ant-..."
    GEMINI_API_KEY="AIza..."
    PERPLEXITY_API_KEY="pplx-..."

    # Google Maps
    GOOGLE_MAPS_API_KEY="AIza..."
    ```

4.  **Initialize Database**
    Push the schema to your PostgreSQL instance:
    ```bash
    npm run db:push
    ```

5.  **Start Development Server**
    ```bash
    npm run dev
    ```
    Access the application at `http://localhost:5000`.

---

## Usage Examples

### Triggering a Strategy Refresh (Client)
The application handles this automatically, but you can force a refresh via the `CoPilotContext`:

```typescript
// client/src/pages/co-pilot/StrategyPage.tsx
const { refreshStrategy, isGenerating } = useCoPilot();

return (
  <Button onClick={() => refreshStrategy({ force: true })} disabled={isGenerating}>
    Generate New Strategy
  </Button>
);
```

### calling an AI Model (Server Adapter)
We use a unified adapter pattern to switch models dynamically:

```javascript
// server/lib/ai/adapters/index.js
import { callModel } from './index.js';

const response = await callModel('strategist', {
  system: "You are a rideshare logistics expert...",
  user: "Analyze current conditions in downtown Austin.",
  // The adapter automatically routes this to Claude 4.5 Opus based on config
});
```

---

## Audit Information

**Auditor**: OpenAI GPT-4o / GPT-5-series (Automated Code Review)

### Key Findings & Resolutions
1.  **Security - Admin Routes**: GPT identified unprotected configuration endpoints.
    *   *Resolution*: Implemented a 4-layer security gate (Feature Flag + IP Allowlist + JWT + Admin User List).
2.  **Performance - React Renders**: Audit flagged excessive re-renders in the location context.
    *   *Resolution*: Implemented stricter `useMemo` dependencies and ref-based callbacks to prevent stale closure loops.
3.  **Data Integrity - Schema Drift**: Detected discrepancies between Drizzle schema and actual DB tables.
    *   *Resolution*: Created `check-standards.js` and `db-doctor.js` self-healing scripts.
4.  **Linting - Hook Safety**: The upgrade to ESLint v9 revealed strict React Hook violations.
    *   *Resolution*: Migrated to Flat Config and addressed critical dependency arrays.

---

## Contribution Guidelines

1.  **AI-First Workflow**: We encourage using AI tools for code generation. However, all AI code must be reviewed against `LESSONS_LEARNED.md` to avoid regression.
2.  **Linting**: Run `npm run lint` before committing. We enforce a zero-warning policy.
3.  **Migrations**: Never modify existing SQL migrations. Create a new one using `drizzle-kit generate`.
4.  **Testing**: Ensure `npm run typecheck` passes.

---

## License

This project is licensed under the **MIT License**.

---

## Changelog

### v4.1.0 - The "AI-Native" Update (Feb 2026)
*   **Integration**: Merged "Vecto-Pilot-Ultimate" features including Hedged Routing and Uber Auth foundations.
*   **Infrastructure**: Migrated to ESLint v9 Flat Config for modern React support.
*   **Architecture**: Implemented "TRIAD" parallel waterfall pipeline for faster strategy generation (35s avg).
*   **Refactor**: Consolidated AI context gathering into `server/lib/ai/context/` and unified coordinate handling.
*   **Feature**: Added **Voice AI Coach** using OpenAI Realtime API.
*   **Reliability**: Added "Fail Hard" pattern for critical data dependencies (Location/Auth).
*   **Data**: Transitioned to 6-decimal GPS precision for ~11cm accuracy in venue matching.

### v4.0.0 - Global Scale (Jan 2026)
*   Refactored from "Dallas-first" to purely location-agnostic architecture.
*   Introduced `coords_cache` to reduce Google API costs by 40%.
*   Integrated Perplexity for global holiday awareness.
